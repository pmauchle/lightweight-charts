/*!
 * @license
 * TradingView Lightweight Charts v4.0.0-dev+202203090750
 * Copyright (c) 2022 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
import{bindToDevicePixelRatio as t}from"fancy-canvas/coordinate-space";var i,s;function n(t,i){const s={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(s)}function e(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(s,i+e),t.lineTo(n,i+e),t.stroke()}function r(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function h(t){if(void 0===t)throw new Error("Value is undefined");return t}function l(t){if(null===t)throw new Error("Value is null");return t}function a(t){return l(h(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(i||(i={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(s||(s={}));const o={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function _(t){return t<0?0:t>255?255:Math.round(t)||0}function u(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const c=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,d=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,f=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,p=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function v(t){(t=t.toLowerCase())in o&&(t=o[t]);{const i=p.exec(t)||f.exec(t);if(i)return[_(parseInt(i[1],10)),_(parseInt(i[2],10)),_(parseInt(i[3],10)),u(i.length<5?1:parseFloat(i[4]))]}{const i=d.exec(t);if(i)return[_(parseInt(i[1],16)),_(parseInt(i[2],16)),_(parseInt(i[3],16)),1]}{const i=c.exec(t);if(i)return[_(17*parseInt(i[1],16)),_(17*parseInt(i[2],16)),_(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function m(t){const i=v(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(s=i,.199*s[0]+.687*s[1]+.114*s[2]>160?"black":"white")};var s}class w{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:!0===s};this.h.push(n)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i)))}g(){return this.h.length>0}M(){this.h=[]}}function b(t,...i){for(const s of i)for(const i in s)void 0!==s[i]&&("object"!=typeof s[i]||void 0===t[i]?t[i]=s[i]:b(t[i],s[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function M(t){return"number"==typeof t&&t%1==0}function S(t){return"string"==typeof t}function y(t){return"boolean"==typeof t}function k(t){const i=t;if(!i||"object"!=typeof i)return i;let s,n,e;for(n in s=Array.isArray(i)?[]:{},i)i.hasOwnProperty(n)&&(e=i[n],s[n]=e&&"object"==typeof e?k(e):e);return s}function x(t){return null!==t}function C(t){return null===t?void 0:t}const T="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function D(t,i,s){return void 0===i&&(i=T),`${s=void 0!==s?`${s} `:""}${t}px ${i}`}class P{constructor(t){this.S={k:1,C:4,T:NaN,D:"",P:"",O:"",N:0,R:0,A:0,I:0,L:0},this.B=t}V(){const t=this.S,i=this.F(),s=this.W();return t.T===i&&t.P===s||(t.T=i,t.P=s,t.D=D(i,s),t.I=Math.floor(i/3.5),t.N=t.I,t.R=Math.max(Math.ceil(i/2-t.C/2),0),t.A=Math.ceil(i/2+t.C/2),t.L=Math.round(i/10)),t.O=this.j(),this.S}j(){return this.B.V().layout.textColor}F(){return this.B.V().layout.fontSize}W(){return this.B.V().layout.fontFamily}}class O{constructor(){this.$=[]}H(t){this.$=t}U(t,i,s,n){this.$.forEach((e=>{t.save(),e.U(t,i,s,n),t.restore()}))}}class N{U(t,i,s,n){t.save(),t.scale(i,i),this.q(t,s,n),t.restore()}Y(t,i,s,n){t.save(),t.scale(i,i),this.X(t,s,n),t.restore()}X(t,i,s){}}class R extends N{constructor(){super(...arguments),this.K=null}Z(t){this.K=t}q(t){if(null===this.K||null===this.K.G)return;const i=this.K.G,s=this.K,n=n=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=s.J[e];t.moveTo(i.tt,i.it),t.arc(i.tt,i.it,n,0,2*Math.PI)}t.fill()};t.fillStyle=s.st,n(s.nt+2),t.fillStyle=s.et,n(s.nt)}}function A(){return{J:[{tt:0,it:0,rt:0,ht:0}],et:"",st:"",nt:0,G:null}}const E={from:0,to:1};class I{constructor(t,i){this.lt=new O,this.ot=[],this._t=[],this.ut=!0,this.B=t,this.ct=i,this.lt.H(this.ot)}dt(t){const i=this.B.ft();i.length!==this.ot.length&&(this._t=i.map(A),this.ot=this._t.map((t=>{const i=new R;return i.Z(t),i})),this.lt.H(this.ot)),this.ut=!0}vt(t,i,s){return this.ut&&(this.wt(t),this.ut=!1),this.lt}wt(t){const i=this.B.ft(),s=this.ct.bt(),n=this.B.gt();i.forEach(((i,e)=>{var r;const h=this._t[e],a=i.Mt(s);if(null===a||!i.St())return void(h.G=null);const o=l(i.yt());h.et=a.kt,h.nt=a.nt,h.J[0].ht=a.ht,h.J[0].it=i.Ct().xt(a.ht,o.Tt),h.st=null!==(r=a.Dt)&&void 0!==r?r:this.B.Pt(h.J[0].it/t),h.J[0].rt=s,h.J[0].tt=n.Ot(s),h.G=E}))}}class L{constructor(t){this.Nt=t}U(t,i,s,r){if(null===this.Nt)return;const h=this.Nt.Rt.St,l=this.Nt.At.St;if(!h&&!l)return;t.save();const a=Math.round(this.Nt.tt*i),o=Math.round(this.Nt.it*i),_=Math.ceil(this.Nt.Et*i),u=Math.ceil(this.Nt.It*i);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Nt.Rt.Lt*i),t.strokeStyle=this.Nt.Rt.O,t.fillStyle=this.Nt.Rt.O,n(t,this.Nt.Rt.Bt),function(t,i,s,n){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,s),t.lineTo(i+e,n),t.stroke()}(t,a,0,u)),l&&o>=0&&(t.lineWidth=Math.floor(this.Nt.At.Lt*i),t.strokeStyle=this.Nt.At.O,t.fillStyle=this.Nt.At.O,n(t,this.Nt.At.Bt),e(t,o,0,_)),t.restore()}}class B{constructor(t){this.ut=!0,this.Vt={Rt:{Lt:1,Bt:0,O:"",St:!1},At:{Lt:1,Bt:0,O:"",St:!1},Et:0,It:0,tt:0,it:0},this.Ft=new L(this.Vt),this.zt=t}dt(){this.ut=!0}vt(t,i){return this.ut&&(this.wt(),this.ut=!1),this.Ft}wt(){const t=this.zt.St(),i=l(this.zt.Wt()),s=i.jt().V().crosshair,n=this.Vt;n.At.St=t&&this.zt.$t(i),n.Rt.St=t&&this.zt.Ht(),n.At.Lt=s.horzLine.width,n.At.Bt=s.horzLine.style,n.At.O=s.horzLine.color,n.Rt.Lt=s.vertLine.width,n.Rt.Bt=s.vertLine.style,n.Rt.O=s.vertLine.color,n.Et=i.Ut(),n.It=i.qt(),n.tt=this.zt.Yt(),n.it=this.zt.Xt()}}function V(t,i,s,n,e,r){t.fillRect(i+r,s,n-2*r,r),t.fillRect(i+r,s+e-r,n-2*r,r),t.fillRect(i,s,r,e),t.fillRect(i+n-r,s,r,e)}function F(t,i,s){t.save(),t.scale(i,i),s(),t.restore()}function z(t,i,s,n,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,s,n,e),t.restore()}function W(t,i,s,n,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,s,n,e),t.restore()}class j{constructor(t,i){this.Z(t,i)}Z(t,i){this.Nt=t,this.Kt=i}U(t,i,s,n,e,r){if(!this.Nt.St)return;t.font=i.D;const h=this.Nt.Zt||!this.Nt.Gt?i.C:0,l=i.k,a=i.I,o=i.N,_=i.R,u=i.A,c=this.Nt.Jt,d=Math.ceil(s.Qt(t,c)),f=i.L,p=i.T+a+o,v=Math.ceil(.5*p),m=l+d+_+u+h;let w=this.Kt.ti;this.Kt.ii&&(w=this.Kt.ii),w=Math.round(w);const b=w-v,g=b+p,M="right"===e,S=M?n:0,y=Math.ceil(n*r);let k,x,C=S;if(t.fillStyle=this.Kt.t,t.lineWidth=1,t.lineCap="butt",c){M?(C=S-m,k=S-h,x=C+u):(C=S+m,k=S+h,x=S+l+h+_);const i=Math.max(1,Math.floor(r)),s=Math.max(1,Math.floor(l*r)),n=M?y:0,e=Math.round(b*r),a=Math.round(C*r),d=Math.round(w*r)-Math.floor(.5*r),p=d+i+(d-e),v=Math.round(k*r);t.save(),t.beginPath(),t.moveTo(n,e),t.lineTo(a,e),t.lineTo(a,p),t.lineTo(n,p),t.fill(),t.fillStyle=this.Nt.Dt,t.fillRect(M?y-s:0,e,s,p-e),this.Nt.Zt&&(t.fillStyle=this.Kt.O,t.fillRect(n,d,v-n,i)),t.textAlign="left",t.fillStyle=this.Kt.O,F(t,r,(()=>{t.fillText(c,x,g-o-f)})),t.restore()}}qt(t,i){return this.Nt.St?t.T+t.I+t.N:0}}class ${constructor(t){this.si={ti:0,O:"#FFF",t:"#000"},this.ni={Jt:"",St:!1,Zt:!0,Gt:!1,Dt:""},this.ei={Jt:"",St:!1,Zt:!1,Gt:!0,Dt:""},this.ut=!0,this.ri=new(t||j)(this.ni,this.si),this.hi=new(t||j)(this.ei,this.si)}Jt(){return this.li(),this.ni.Jt}ti(){return this.li(),this.si.ti}dt(){this.ut=!0}qt(t,i=!1){return Math.max(this.ri.qt(t,i),this.hi.qt(t,i))}ai(){return this.si.ii||0}oi(t){this.si.ii=t}_i(){return this.li(),this.ni.St||this.ei.St}ui(){return this.li(),this.ni.St}vt(t){return this.li(),this.ni.Zt=this.ni.Zt&&t.V().drawTicks,this.ei.Zt=this.ei.Zt&&t.V().drawTicks,this.ri.Z(this.ni,this.si),this.hi.Z(this.ei,this.si),this.ri}ci(){return this.li(),this.ri.Z(this.ni,this.si),this.hi.Z(this.ei,this.si),this.hi}li(){this.ut&&(this.ni.Zt=!0,this.ei.Zt=!1,this.di(this.ni,this.ei,this.si))}}class H extends ${constructor(t,i,s){super(),this.zt=t,this.fi=i,this.pi=s}di(t,i,s){t.St=!1;const n=this.zt.V().horzLine;if(!n.labelVisible)return;const e=this.fi.yt();if(!this.zt.St()||this.fi.vi()||null===e)return;const r=m(n.labelBackgroundColor);s.t=r.t,s.O=r.i;const h=this.pi(this.fi);s.ti=h.ti,t.Jt=this.fi.mi(h.ht,e),t.St=!0}}const U=/[1-9]/g;class q{constructor(){this.Nt=null}Z(t){this.Nt=t}U(t,i,s){if(null===this.Nt||!1===this.Nt.St||0===this.Nt.Jt.length)return;t.font=i.D;const n=Math.round(i.wi.Qt(t,this.Nt.Jt,U));if(n<=0)return;t.save();const e=i.bi,r=n+2*e,h=r/2,a=this.Nt.Ut;let o=this.Nt.ti,_=Math.floor(o-h)+.5;_<0?(o+=Math.abs(0-_),_=Math.floor(o-h)+.5):_+r>a&&(o-=Math.abs(a-(_+r)),_=Math.floor(o-h)+.5);const u=_+r,c=0+i.k+i.I+i.T+i.N;t.fillStyle=this.Nt.t;const d=Math.round(_*s),f=Math.round(0*s),p=Math.round(u*s),v=Math.round(c*s);t.fillRect(d,f,p-d,v-f);const m=Math.round(this.Nt.ti*s),w=f,b=Math.round((w+i.k+i.C)*s);t.fillStyle=this.Nt.O;const g=Math.max(1,Math.floor(s)),M=Math.floor(.5*s);t.fillRect(m-M,w,g,b-w);const S=c-i.L-i.N;t.textAlign="left",t.fillStyle=this.Nt.O,F(t,s,(()=>{t.fillText(l(this.Nt).Jt,_+e,S)})),t.restore()}}class Y{constructor(t,i,s){this.ut=!0,this.Ft=new q,this.Vt={St:!1,t:"#4c525e",O:"white",Jt:"",Ut:0,ti:NaN},this.ct=t,this.gi=i,this.pi=s}dt(){this.ut=!0}vt(){return this.ut&&(this.wt(),this.ut=!1),this.Ft.Z(this.Vt),this.Ft}wt(){const t=this.Vt;t.St=!1;const i=this.ct.V().vertLine;if(!i.labelVisible)return;const s=this.gi.gt();if(s.vi())return;t.Ut=s.Ut();const n=this.pi();if(!n.rt)return;t.ti=n.ti;const e=s.Mi(this.ct.bt());t.Jt=s.Si(l(e)),t.St=!0;const r=m(i.labelBackgroundColor);t.t=r.t,t.O=r.i}}class X{constructor(){this.yi=null,this.ki=0}xi(){return this.ki}Ci(t){this.ki=t}Ct(){return this.yi}Ti(t){this.yi=t}Di(){return[]}St(){return!0}}var K;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(K||(K={}));class Z extends X{constructor(t,i){super(),this.Pi=null,this.Oi=NaN,this.Ni=0,this.Ri=!0,this.Ai=new Map,this.Ei=!1,this.Ii=NaN,this.Li=NaN,this.Bi=NaN,this.Vi=NaN,this.gi=t,this.Fi=i,this.zi=new I(t,this);this.Wi=((t,i)=>s=>{const n=i(),e=t();if(s===l(this.Pi).ji())return{ht:e,ti:n};{const t=l(s.yt());return{ht:s.$i(n,t),ti:n}}})((()=>this.Oi),(()=>this.Li));const s=((t,i)=>()=>({rt:this.gi.gt().Hi(t()),ti:i()}))((()=>this.Ni),(()=>this.Yt()));this.Ui=new Y(this,t,s),this.qi=new B(this)}V(){return this.Fi}Yi(t,i){this.Bi=t,this.Vi=i}Xi(){this.Bi=NaN,this.Vi=NaN}Ki(){return this.Bi}Zi(){return this.Vi}Gi(t,i,s){this.Ei||(this.Ei=!0),this.Ri=!0,this.Ji(t,i,s)}bt(){return this.Ni}Yt(){return this.Ii}Xt(){return this.Li}St(){return this.Ri}Qi(){this.Ri=!1,this.ts(),this.Oi=NaN,this.Ii=NaN,this.Li=NaN,this.Pi=null,this.Xi()}ss(t){return null!==this.Pi?[this.qi,this.zi]:[]}$t(t){return t===this.Pi&&this.Fi.horzLine.visible}Ht(){return this.Fi.vertLine.visible}ns(t,i){this.Ri&&this.Pi===t||this.Ai.clear();const s=[];return this.Pi===t&&s.push(this.es(this.Ai,i,this.Wi)),s}Di(){return this.Ri?[this.Ui]:[]}Wt(){return this.Pi}rs(){this.qi.dt(),this.Ai.forEach((t=>t.dt())),this.Ui.dt(),this.zi.dt()}hs(t){return t&&!t.ji().vi()?t.ji():null}Ji(t,i,s){this.ls(t,i,s)&&this.rs()}ls(t,i,s){const n=this.Ii,e=this.Li,r=this.Oi,h=this.Ni,l=this.Pi,a=this.hs(s);this.Ni=t,this.Ii=isNaN(t)?NaN:this.gi.gt().Ot(t),this.Pi=s;const o=null!==a?a.yt():null;return null!==a&&null!==o?(this.Oi=i,this.Li=a.xt(i,o)):(this.Oi=NaN,this.Li=NaN),n!==this.Ii||e!==this.Li||h!==this.Ni||r!==this.Oi||l!==this.Pi}ts(){const t=this.gi.ft().map((t=>t._s().os())).filter(x),i=0===t.length?null:Math.max(...t);this.Ni=null!==i?i:NaN}es(t,i,s){let n=t.get(i);return void 0===n&&(n=new H(this,i,s),t.set(i,n)),n}}function G(t){return"left"===t||"right"===t}class J{constructor(t){this.us=new Map,this.cs=[],this.ds=t}fs(t,i){const s=function(t,i){return void 0===t?i:{ps:Math.max(t.ps,i.ps),vs:t.vs||i.vs}}(this.us.get(t),i);this.us.set(t,s)}ws(){return this.ds}bs(t){const i=this.us.get(t);return void 0===i?{ps:this.ds}:{ps:Math.max(this.ds,i.ps),vs:i.vs}}gs(){this.cs=[{Ms:0}]}Ss(t){this.cs=[{Ms:1,Tt:t}]}ys(){this.cs=[{Ms:4}]}ks(t){this.cs.push({Ms:2,Tt:t})}xs(t){this.cs.push({Ms:3,Tt:t})}Cs(){return this.cs}Ts(t){for(const i of t.cs)this.Ds(i);this.ds=Math.max(this.ds,t.ds),t.us.forEach(((t,i)=>{this.fs(i,t)}))}Ds(t){switch(t.Ms){case 0:this.gs();break;case 1:this.Ss(t.Tt);break;case 2:this.ks(t.Tt);break;case 3:this.xs(t.Tt);break;case 4:this.ys()}}}const Q=".";function tt(t,i){if(!g(t))return"n/a";if(!M(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class it{constructor(t,i){if(i||(i=1),g(t)&&M(t)||(t=100),t<0)throw new TypeError("invalid base");this.fi=t,this.Ps=i,this.Os()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.Ns(t)}Os(){if(this.Rs=0,this.fi>0&&this.Ps>0){let t=this.fi;for(;t>1;)t/=10,this.Rs++}}Ns(t){const i=this.fi/this.Ps;let s=Math.floor(t),n="";const e=void 0!==this.Rs?this.Rs:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.Rs);r>=i&&(r-=i,s+=1),n=Q+tt(+r.toFixed(this.Rs)*this.Ps,e)}else s=Math.round(s*i)/i,e>0&&(n=Q+tt(0,e));return s.toFixed(0)+n}}class st extends it{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class nt{constructor(t){this.As=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.Es(t):t<999995?i+this.Es(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.Es(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.Es(t/1e9)+"B")}Es(t){let i;const s=Math.pow(10,this.As);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.As).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function et(t,i,s,n){if(0===i.length)return;const e=i[n.from].tt,r=i[n.from].it;t.moveTo(e,r);for(let e=n.from+1;e<n.to;++e){const n=i[e];switch(s){case 0:t.lineTo(n.tt,n.it);break;case 1:t.lineTo(n.tt,i[e-1].it),t.lineTo(n.tt,n.it);break;case 2:{const[s,r]=lt(i,e-1,e);t.bezierCurveTo(s.tt,s.it,r.tt,r.it,n.tt,n.it);break}}}}function rt(t,i){return{tt:t.tt-i.tt,it:t.it-i.it}}function ht(t,i){return{tt:t.tt/i,it:t.it/i}}function lt(t,i,s){const n=Math.max(0,i-1),e=Math.min(t.length-1,s+1);var r,h;return[(r=t[i],h=ht(rt(t[s],t[n]),6),{tt:r.tt+h.tt,it:r.it+h.it}),rt(t[s],ht(rt(t[e],t[i]),6))]}class at extends N{constructor(){super(...arguments),this.K=null}Z(t){this.K=t}q(t){if(null!==this.K&&0!==this.K.J.length&&null!==this.K.G){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this.K.Lt,n(t,this.K.Bt),t.lineWidth=1,t.beginPath(),1===this.K.J.length){const i=this.K.J[0],s=this.K.Is/2;t.moveTo(i.tt-s,this.K.Ls),t.lineTo(i.tt-s,i.it),t.lineTo(i.tt+s,i.it),t.lineTo(i.tt+s,this.K.Ls)}else t.moveTo(this.K.J[this.K.G.from].tt,this.K.Ls),t.lineTo(this.K.J[this.K.G.from].tt,this.K.J[this.K.G.from].it),et(t,this.K.J,this.K.Bs,this.K.G),this.K.G.to>this.K.G.from&&(t.lineTo(this.K.J[this.K.G.to-1].tt,this.K.Ls),t.lineTo(this.K.J[this.K.G.from].tt,this.K.Ls));t.closePath(),t.fillStyle=this.Vs(t),t.fill()}}}class ot extends at{Vs(t){const i=this.K,s=t.createLinearGradient(0,0,0,i.Fs);return s.addColorStop(0,i.zs),s.addColorStop(1,i.Ws),s}}class _t extends N{constructor(){super(...arguments),this.K=null}Z(t){this.K=t}q(t){if(null!==this.K&&0!==this.K.J.length&&null!==this.K.G)if(t.lineCap="butt",t.lineWidth=this.K.Lt,n(t,this.K.Bt),t.strokeStyle=this.js(t),t.lineJoin="round",1===this.K.J.length){t.beginPath();const i=this.K.J[0];t.moveTo(i.tt-this.K.Is/2,i.it),t.lineTo(i.tt+this.K.Is/2,i.it),void 0!==i.O&&(t.strokeStyle=i.O),t.stroke()}else this.$s(t,this.K)}$s(t,i){t.beginPath(),et(t,i.J,i.Bs,i.G),t.stroke()}}class ut extends _t{$s(t,i){var s,n;const{J:e,G:r,Bs:h,et:l}=i;if(0===e.length||null===r)return;t.beginPath();const a=e[r.from];t.moveTo(a.tt,a.it);let o=null!==(s=a.O)&&void 0!==s?s:l;t.strokeStyle=o;const _=i=>{t.stroke(),t.beginPath(),t.strokeStyle=i,o=i};for(let i=r.from+1;i<r.to;++i){const s=e[i],r=null!==(n=s.O)&&void 0!==n?n:l;switch(h){case 0:t.lineTo(s.tt,s.it);break;case 1:t.lineTo(s.tt,e[i-1].it),r!==o&&(_(r),t.lineTo(s.tt,e[i-1].it)),t.lineTo(s.tt,s.it);break;case 2:{const[n,r]=lt(e,i-1,i);t.bezierCurveTo(n.tt,n.it,r.tt,r.it,s.tt,s.it);break}}1!==h&&r!==o&&(_(r),t.moveTo(s.tt,s.it))}t.stroke()}js(){return this.K.et}}function ct(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(t[h],i)?(n=h+1,r-=e+1):r=e}return n}function dt(t,i,s,n=0,e=t.length){let r=e-n;for(;0<r;){const e=r>>1,h=n+e;s(i,t[h])?r=e:(n=h+1,r-=e+1)}return n}function ft(t,i){return t.rt<i}function pt(t,i){return t<i.rt}function vt(t,i,s){const n=i.Hs(),e=i.Us(),r=ct(t,n,ft),h=dt(t,e,pt);if(!s)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].rt>=n&&(l=r-1),h>0&&h<t.length&&t[h-1].rt<=e&&(a=h+1),{from:l,to:a}}class mt{constructor(t,i,s){this.qs=!0,this.Ys=!0,this.Xs=!0,this.Ks=[],this.Zs=null,this.Gs=t,this.Js=i,this.Qs=s}dt(t){this.qs=!0,"data"===t&&(this.Ys=!0),"options"===t&&(this.Xs=!0)}tn(){this.Ys&&(this.sn(),this.Ys=!1),this.qs&&(this.nn(),this.qs=!1),this.Xs&&(this.en(),this.Xs=!1)}rn(){this.Zs=null}nn(){const t=this.Gs.Ct(),i=this.Js.gt();if(this.rn(),i.vi()||t.vi())return;const s=i.hn();if(null===s)return;if(0===this.Gs._s().ln())return;const n=this.Gs.yt();null!==n&&(this.Zs=vt(this.Ks,s,this.Qs),this.an(t,i,n.Tt))}}class wt extends mt{constructor(t,i){super(t,i,!0)}an(t,i,s){i.on(this.Ks,C(this.Zs)),t._n(this.Ks,s,C(this.Zs))}un(t,i){return{rt:t,ht:i,tt:NaN,it:NaN}}en(){}sn(){const t=this.Gs.cn();this.Ks=this.Gs._s().dn().map((i=>{const s=i.Tt[3];return this.fn(i.pn,s,t)}))}}class bt extends wt{constructor(t,i){super(t,i),this.Ft=new O,this.vn=new ot,this.mn=new ut,this.Ft.H([this.vn,this.mn])}vt(t,i){if(!this.Gs.St())return null;const s=this.Gs.V();return this.tn(),this.vn.Z({Bs:s.lineType,J:this.Ks,Bt:s.lineStyle,Lt:s.lineWidth,zs:s.topColor,Ws:s.bottomColor,Ls:t,Fs:t,G:this.Zs,Is:this.Js.gt().wn()}),this.mn.Z({Bs:s.lineType,J:this.Ks,et:s.lineColor,Bt:s.lineStyle,Lt:s.lineWidth,G:this.Zs,Is:this.Js.gt().wn()}),this.Ft}fn(t,i){return this.un(t,i)}}class gt{constructor(){this.Nt=null,this.bn=0,this.gn=0}Z(t){this.Nt=t}U(t,i,s,n){if(null===this.Nt||0===this.Nt._s.length||null===this.Nt.G)return;if(this.bn=this.Mn(i),this.bn>=2){Math.max(1,Math.floor(i))%2!=this.bn%2&&this.bn--}this.gn=this.Nt.Sn?Math.min(this.bn,Math.floor(i)):this.bn;let e=null;const r=this.gn<=this.bn&&this.Nt.wn>=Math.floor(1.5*i);for(let s=this.Nt.G.from;s<this.Nt.G.to;++s){const n=this.Nt._s[s];e!==n.O&&(t.fillStyle=n.O,e=n.O);const h=Math.floor(.5*this.gn),l=Math.round(n.tt*i),a=l-h,o=this.gn,_=a+o-1,u=Math.min(n.yn,n.kn),c=Math.max(n.yn,n.kn),d=Math.round(u*i)-h,f=Math.round(c*i)+h,p=Math.max(f-d,this.gn);t.fillRect(a,d,o,p);const v=Math.ceil(1.5*this.bn);if(r){if(this.Nt.xn){const s=l-v;let e=Math.max(d,Math.round(n.Cn*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(s,e,a-s,r-e+1)}const s=l+v;let e=Math.max(d,Math.round(n.Tn*i)-h),r=e+o-1;r>d+p-1&&(r=d+p-1,e=r-o+1),t.fillRect(_+1,e,s-_,r-e+1)}}}Mn(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(l(this.Nt).wn,t)))}}class Mt extends mt{constructor(t,i){super(t,i,!1)}an(t,i,s){i.on(this.Ks,C(this.Zs)),t.Dn(this.Ks,s,C(this.Zs))}Pn(t,i,s){return{rt:t,On:i.Tt[0],Nn:i.Tt[1],Rn:i.Tt[2],An:i.Tt[3],tt:NaN,Cn:NaN,yn:NaN,kn:NaN,Tn:NaN}}sn(){const t=this.Gs.cn();this.Ks=this.Gs._s().dn().map((i=>this.fn(i.pn,i,t)))}}class St extends Mt{constructor(){super(...arguments),this.Ft=new gt}vt(t,i){if(!this.Gs.St())return null;const s=this.Gs.V();this.tn();const n={_s:this.Ks,wn:this.Js.gt().wn(),xn:s.openVisible,Sn:s.thinBars,G:this.Zs};return this.Ft.Z(n),this.Ft}en(){this.Ks.forEach((t=>{t.O=this.Gs.cn().In(t.rt).En}))}fn(t,i,s){return Object.assign(Object.assign({},this.Pn(t,i,s)),{O:s.In(t).En})}}function yt(t,i,s){return Math.min(Math.max(t,i),s)}function kt(t,i,s){return i-t<=s}function xt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Ct(t){const i=Math.ceil(t);return i%2!=0?i-1:i}function Tt(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Dt extends at{Vs(t){const i=this.K,s=t.createLinearGradient(0,0,0,i.Fs),n=yt(i.Ls/i.Fs,0,1);return s.addColorStop(0,i.Ln),s.addColorStop(n,i.Bn),s.addColorStop(n,i.Vn),s.addColorStop(1,i.Fn),s}}class Pt extends _t{js(t){const i=this.K,s=t.createLinearGradient(0,0,0,i.Fs),n=yt(i.Ls/i.Fs,0,1);return s.addColorStop(0,i.zs),s.addColorStop(n,i.zs),s.addColorStop(n,i.Ws),s.addColorStop(1,i.Ws),s}}class Ot extends wt{constructor(t,i){super(t,i),this.zn=new Dt,this.Wn=new Pt,this.lt=new O,this.lt.H([this.zn,this.Wn])}vt(t,i){if(!this.Gs.St())return null;const s=this.Gs.yt();if(null===s)return null;const n=this.Gs.V();this.tn();const e=this.Gs.Ct().xt(n.baseValue.price,s.Tt),r=this.Js.gt().wn();return this.zn.Z({J:this.Ks,Ln:n.topFillColor1,Bn:n.topFillColor2,Vn:n.bottomFillColor1,Fn:n.bottomFillColor2,Lt:n.lineWidth,Bt:n.lineStyle,Bs:n.lineType,Ls:e,Fs:t,G:this.Zs,Is:r}),this.Wn.Z({J:this.Ks,zs:n.topLineColor,Ws:n.bottomLineColor,Lt:n.lineWidth,Bt:n.lineStyle,Bs:n.lineType,Ls:e,Fs:t,G:this.Zs,Is:r}),this.lt}fn(t,i){return this.un(t,i)}}class Nt{constructor(){this.Nt=null,this.bn=0}Z(t){this.Nt=t}U(t,i,s,n){if(null===this.Nt||0===this.Nt._s.length||null===this.Nt.G)return;if(this.bn=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const s=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),n=Math.floor(t*s*i),e=Math.floor(t*i),r=Math.min(n,e);return Math.max(Math.floor(i),r)}(this.Nt.wn,i),this.bn>=2){Math.floor(i)%2!=this.bn%2&&this.bn--}const e=this.Nt._s;this.Nt.jn&&this.$n(t,e,this.Nt.G,i),this.Nt.Hn&&this.Un(t,e,this.Nt.G,this.Nt.wn,i);const r=this.qn(i);(!this.Nt.Hn||this.bn>2*r)&&this.Yn(t,e,this.Nt.G,i)}$n(t,i,s,n){if(null===this.Nt)return;let e="",r=Math.min(Math.floor(n),Math.floor(this.Nt.wn*n));r=Math.max(Math.floor(n),Math.min(r,this.bn));const h=Math.floor(.5*r);let l=null;for(let a=s.from;a<s.to;a++){const s=i[a];s.Xn!==e&&(t.fillStyle=s.Xn,e=s.Xn);const o=Math.round(Math.min(s.Cn,s.Tn)*n),_=Math.round(Math.max(s.Cn,s.Tn)*n),u=Math.round(s.yn*n),c=Math.round(s.kn*n);let d=Math.round(n*s.tt)-h;const f=d+r-1;null!==l&&(d=Math.max(l+1,d),d=Math.min(d,f));const p=f-d+1;t.fillRect(d,u,p,o-u),t.fillRect(d,_+1,p,c-_),l=f}}qn(t){let i=Math.floor(1*t);this.bn<=2*i&&(i=Math.floor(.5*(this.bn-1)));const s=Math.max(Math.floor(t),i);return this.bn<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}Un(t,i,s,n,e){if(null===this.Nt)return;let r="";const h=this.qn(e);let l=null;for(let n=s.from;n<s.to;n++){const s=i[n];s.Dt!==r&&(t.fillStyle=s.Dt,r=s.Dt);let a=Math.round(s.tt*e)-Math.floor(.5*this.bn);const o=a+this.bn-1,_=Math.round(Math.min(s.Cn,s.Tn)*e),u=Math.round(Math.max(s.Cn,s.Tn)*e);if(null!==l&&(a=Math.max(l+1,a),a=Math.min(a,o)),this.Nt.wn*e>2*h)V(t,a,_,o-a+1,u-_+1,h);else{const i=o-a+1;t.fillRect(a,_,i,u-_+1)}l=o}}Yn(t,i,s,n){if(null===this.Nt)return;let e="";const r=this.qn(n);for(let h=s.from;h<s.to;h++){const s=i[h];let l=Math.round(Math.min(s.Cn,s.Tn)*n),a=Math.round(Math.max(s.Cn,s.Tn)*n),o=Math.round(s.tt*n)-Math.floor(.5*this.bn),_=o+this.bn-1;if(s.O!==e){const i=s.O;t.fillStyle=i,e=i}this.Nt.Hn&&(o+=r,l+=r,_-=r,a-=r),l>a||t.fillRect(o,l,_-o+1,a-l+1)}}}class Rt extends Mt{constructor(){super(...arguments),this.Ft=new Nt}vt(t,i){if(!this.Gs.St())return null;const s=this.Gs.V();this.tn();const n={_s:this.Ks,wn:this.Js.gt().wn(),jn:s.wickVisible,Hn:s.borderVisible,G:this.Zs};return this.Ft.Z(n),this.Ft}en(){this.Ks.forEach((t=>{const i=this.Gs.cn().In(t.rt);t.O=i.En,t.Xn=i.Kn,t.Dt=i.Zn}))}fn(t,i,s){const n=s.In(t);return Object.assign(Object.assign({},this.Pn(t,i,s)),{O:n.En,Xn:n.Kn,Dt:n.Zn})}}class At{constructor(){this.Nt=null,this.Gn=[]}Z(t){this.Nt=t,this.Gn=[]}U(t,i,s,n){if(null===this.Nt||0===this.Nt.J.length||null===this.Nt.G)return;this.Gn.length||this.Jn(i);const e=Math.max(1,Math.floor(i)),r=Math.round(this.Nt.Qn*i)-Math.floor(e/2),h=r+e;for(let s=this.Nt.G.from;s<this.Nt.G.to;s++){const n=this.Nt.J[s],l=this.Gn[s-this.Nt.G.from],a=Math.round(n.it*i);let o,_;t.fillStyle=n.O,a<=r?(o=a,_=h):(o=r,_=a-Math.floor(e/2)+e),t.fillRect(l.Hs,o,l.Us-l.Hs+1,_-o)}}Jn(t){if(null===this.Nt||0===this.Nt.J.length||null===this.Nt.G)return void(this.Gn=[]);const i=Math.ceil(this.Nt.wn*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Nt.wn*t)-i;this.Gn=new Array(this.Nt.G.to-this.Nt.G.from);for(let i=this.Nt.G.from;i<this.Nt.G.to;i++){const n=this.Nt.J[i],e=Math.round(n.tt*t);let r,h;if(s%2){const t=(s-1)/2;r=e-t,h=e+t}else{const t=s/2;r=e-t,h=e+t-1}this.Gn[i-this.Nt.G.from]={Hs:r,Us:h,te:e,ie:n.tt*t,rt:n.rt}}for(let t=this.Nt.G.from+1;t<this.Nt.G.to;t++){const s=this.Gn[t-this.Nt.G.from],n=this.Gn[t-this.Nt.G.from-1];s.rt===n.rt+1&&(s.Hs-n.Us!==i+1&&(n.te>n.ie?n.Us=s.Hs-i-1:s.Hs=n.Us+i+1))}let n=Math.ceil(this.Nt.wn*t);for(let t=this.Nt.G.from;t<this.Nt.G.to;t++){const i=this.Gn[t-this.Nt.G.from];i.Us<i.Hs&&(i.Us=i.Hs);const s=i.Us-i.Hs+1;n=Math.min(s,n)}if(i>0&&n<4)for(let t=this.Nt.G.from;t<this.Nt.G.to;t++){const i=this.Gn[t-this.Nt.G.from];i.Us-i.Hs+1>n&&(i.te>i.ie?i.Us-=1:i.Hs+=1)}}}function Et(t){return{J:[],wn:t,Qn:NaN,G:null}}function It(t,i,s){return{rt:t,ht:i,tt:NaN,it:NaN,O:s}}class Lt extends mt{constructor(t,i){super(t,i,!1),this.lt=new O,this.se=Et(0),this.Ft=new At}vt(t,i){return this.Gs.St()?(this.tn(),this.lt):null}sn(){const t=this.Js.gt().wn();this.se=Et(t);let i=0,s=0;const n=this.Gs.V().color;for(const t of this.Gs._s().dn()){const e=t.Tt[3],r=void 0!==t.O?t.O:n,h=It(t.pn,e,r);i++,i<this.se.J.length?this.se.J[i]=h:this.se.J.push(h),this.Ks[s++]={rt:t.pn,tt:0}}this.Ft.Z(this.se),this.lt.H([this.Ft])}en(){}rn(){super.rn(),this.se.G=null}an(t,i,s){if(null===this.Zs)return;const n=i.wn(),e=l(i.hn()),r=t.xt(this.Gs.V().base,s);i.on(this.se.J),t._n(this.se.J,s),this.se.Qn=r,this.se.G=vt(this.se.J,e,!1),this.se.wn=n,this.Ft.Z(this.se)}}class Bt extends wt{constructor(t,i){super(t,i),this.mn=new ut}vt(t,i){if(!this.Gs.St())return null;const s=this.Gs.V();this.tn();const n={J:this.Ks,et:s.color,Bt:s.lineStyle,Bs:s.lineType,Lt:s.lineWidth,G:this.Zs,Is:this.Js.gt().wn()};return this.mn.Z(n),this.mn}en(){this.Ks.forEach((t=>{t.O=this.Gs.cn().In(t.rt).En}))}fn(t,i,s){const n=this.un(t,i);return n.O=s.In(t).En,n}}const Vt=/[2-9]/g;class Ft{constructor(t=50){this.ne=new Map,this.ee=0,this.re=Array.from(new Array(t))}he(){this.ne.clear(),this.re.fill(void 0)}Qt(t,i,s){const n=s||Vt,e=String(i).replace(n,"0");let r=this.ne.get(e);if(void 0===r){if(r=t.measureText(e).width,0===r&&0!==i.length)return 0;const s=this.re[this.ee];void 0!==s&&this.ne.delete(s),this.re[this.ee]=e,this.ee=(this.ee+1)%this.re.length,this.ne.set(e,r)}return r}}class zt{constructor(t){this.le=null,this.S=null,this.ae="right",this.oe=0,this._e=t}ue(t,i,s,n){this.le=t,this.S=i,this.oe=s,this.ae=n}U(t,i){null!==this.S&&null!==this.le&&this.le.U(t,this.S,this._e,this.oe,this.ae,i)}}class Wt{constructor(t,i,s){this.ce=t,this._e=new Ft(50),this.de=i,this.B=s,this.F=-1,this.Ft=new zt(this._e)}vt(t,i){const s=this.B.fe(this.de);if(null===s)return null;const n=s.pe(this.de)?s.ve():this.de.Ct();if(null===n)return null;const e=s.me(n);if("overlay"===e)return null;const r=this.B.we();return r.T!==this.F&&(this.F=r.T,this._e.he()),this.Ft.ue(this.ce.ci(),r,i,e),this.Ft}}class jt{constructor(){this.Nt=null}Z(t){this.Nt=t}U(t,i,s,r){if(null===this.Nt)return;if(!1===this.Nt.St)return;const h=Math.round(this.Nt.it*i);if(h<0||h>Math.ceil(this.Nt.qt*i))return;const l=Math.ceil(this.Nt.Ut*i);t.lineCap="butt",t.strokeStyle=this.Nt.O,t.lineWidth=Math.floor(this.Nt.Lt*i),n(t,this.Nt.Bt),e(t,h,0,l)}}class $t{constructor(t){this.be={Ut:0,qt:0,it:0,O:"rgba(0, 0, 0, 0)",Lt:1,Bt:0,St:!1},this.ge=new jt,this.ut=!0,this.Gs=t,this.Js=t.jt(),this.ge.Z(this.be)}dt(){this.ut=!0}vt(t,i){return this.Gs.St()?(this.ut&&(this.Me(t,i),this.ut=!1),this.ge):null}}class Ht extends $t{constructor(t){super(t)}Me(t,i){this.be.St=!1;const s=this.Gs.Ct(),n=s.Se().Se;if(2!==n&&3!==n)return;const e=this.Gs.V();if(!e.baseLineVisible||!this.Gs.St())return;const r=this.Gs.yt();null!==r&&(this.be.St=!0,this.be.it=s.xt(r.Tt,r.Tt),this.be.Ut=i,this.be.qt=t,this.be.O=e.baseLineColor,this.be.Lt=e.baseLineWidth,this.be.Bt=e.baseLineStyle)}}class Ut{constructor(){this.Nt=null}Z(t){this.Nt=t}ye(){return this.Nt}U(t,i,s,n){const e=this.Nt;if(null===e)return;t.save();const r=Math.max(1,Math.floor(i)),h=r%2/2,l=Math.round(e.ie.x*i)+h,a=e.ie.y*i;t.fillStyle=e.ke,t.beginPath();const o=Math.max(2,1.5*e.xe)*i;t.arc(l,a,o,0,2*Math.PI,!1),t.fill(),t.fillStyle=e.Ce,t.beginPath(),t.arc(l,a,e.nt*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=e.Te,t.beginPath(),t.arc(l,a,e.nt*i+r/2,0,2*Math.PI,!1),t.stroke(),t.restore()}}const qt=[{De:0,Pe:.25,Oe:4,Ne:10,Re:.25,Ae:0,Ee:.4,Ie:.8},{De:.25,Pe:.525,Oe:10,Ne:14,Re:0,Ae:0,Ee:.8,Ie:0},{De:.525,Pe:1,Oe:14,Ne:14,Re:0,Ae:0,Ee:0,Ie:0}];function Yt(t,i,s,n){return function(t,i){if("transparent"===t)return t;const s=v(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${i*n})`}(t,s+(n-s)*i)}function Xt(t,i){const s=t%2600/2600;let n;for(const t of qt)if(s>=t.De&&s<=t.Pe){n=t;break}r(void 0!==n,"Last price animation internal logic error");const e=(s-n.De)/(n.Pe-n.De);return{Ce:Yt(i,e,n.Re,n.Ae),Te:Yt(i,e,n.Ee,n.Ie),nt:(h=e,l=n.Oe,a=n.Ne,l+(a-l)*h)};var h,l,a}class Kt{constructor(t){this.Ft=new Ut,this.ut=!0,this.Le=!0,this.Be=performance.now(),this.Ve=this.Be-1,this.Fe=t}ze(){this.Ve=this.Be-1,this.dt()}We(){if(this.dt(),2===this.Fe.V().lastPriceAnimation){const t=performance.now(),i=this.Ve-t;if(i>0)return void(i<650&&(this.Ve+=2600));this.Be=t,this.Ve=t+2600}}dt(){this.ut=!0}je(){this.Le=!0}St(){return 0!==this.Fe.V().lastPriceAnimation}$e(){switch(this.Fe.V().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Ve}}vt(t,i){return this.ut?(this.wt(t,i),this.ut=!1,this.Le=!1):this.Le&&(this.He(),this.Le=!1),this.Ft}wt(t,i){this.Ft.Z(null);const s=this.Fe.jt().gt(),n=s.hn(),e=this.Fe.yt();if(null===n||null===e)return;const r=this.Fe.Ue(!0);if(r.qe||!n.Ye(r.pn))return;const h={x:s.Ot(r.pn),y:this.Fe.Ct().xt(r.ht,e.Tt)},l=r.O,a=this.Fe.V().lineWidth,o=Xt(this.Xe(),l);this.Ft.Z({ke:l,xe:a,Ce:o.Ce,Te:o.Te,nt:o.nt,ie:h})}He(){const t=this.Ft.ye();if(null!==t){const i=Xt(this.Xe(),t.ke);t.Ce=i.Ce,t.Te=i.Te,t.nt=i.nt}}Xe(){return this.$e()?performance.now()-this.Be:2599}}function Zt(t,i){return Tt(Math.min(Math.max(t,12),30)*i)}function Gt(t,i){switch(t){case"arrowDown":case"arrowUp":return Zt(i,1);case"circle":return Zt(i,.8);case"square":return Zt(i,.7)}}function Jt(t){return Ct(Zt(t,1))}function Qt(t){return Math.max(Zt(t,.1),3)}function ti(t,i,s,n,e){const r=Gt("square",s),h=(r-1)/2,l=t-h,a=i-h;return n>=l&&n<=l+r&&e>=a&&e<=a+r}function ii(t,i,s,n,e){const r=(Gt("arrowUp",e)-1)/2,h=(Tt(e/2)-1)/2;i.beginPath(),t?(i.moveTo(s-r,n),i.lineTo(s,n-r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n+r),i.lineTo(s-h,n+r),i.lineTo(s-h,n)):(i.moveTo(s-r,n),i.lineTo(s,n+r),i.lineTo(s+r,n),i.lineTo(s+h,n),i.lineTo(s+h,n-r),i.lineTo(s-h,n-r),i.lineTo(s-h,n)),i.fill()}function si(t,i,s,n,e,r){return ti(i,s,n,e,r)}class ni extends N{constructor(){super(...arguments),this.Nt=null,this._e=new Ft,this.F=-1,this.W="",this.Ke=""}Z(t){this.Nt=t}ue(t,i){this.F===t&&this.W===i||(this.F=t,this.W=i,this.Ke=D(t,i),this._e.he())}Ze(t,i){if(null===this.Nt||null===this.Nt.G)return null;for(let s=this.Nt.G.from;s<this.Nt.G.to;s++){const n=this.Nt.J[s];if(ri(n,t,i))return{Ge:n.Je,Qe:n.Qe}}return null}q(t,i,s){if(null!==this.Nt&&null!==this.Nt.G){t.textBaseline="middle",t.font=this.Ke;for(let i=this.Nt.G.from;i<this.Nt.G.to;i++){const s=this.Nt.J[i];void 0!==s.Jt&&(s.Jt.Ut=this._e.Qt(t,s.Jt.tr),s.Jt.qt=this.F),ei(s,t)}}}}function ei(t,i){i.fillStyle=t.O,void 0!==t.Jt&&function(t,i,s,n){t.fillText(i,s,n)}(i,t.Jt.tr,t.tt-t.Jt.Ut/2,t.Jt.it),function(t,i){if(0===t.ln)return;switch(t.ir){case"arrowDown":return void ii(!1,i,t.tt,t.it,t.ln);case"arrowUp":return void ii(!0,i,t.tt,t.it,t.ln);case"circle":return void function(t,i,s,n){const e=(Gt("circle",n)-1)/2;t.beginPath(),t.arc(i,s,e,0,2*Math.PI,!1),t.fill()}(i,t.tt,t.it,t.ln);case"square":return void function(t,i,s,n){const e=Gt("square",n),r=(e-1)/2,h=i-r,l=s-r;t.fillRect(h,l,e,e)}(i,t.tt,t.it,t.ln)}t.ir}(t,i)}function ri(t,i,s){return!(void 0===t.Jt||!function(t,i,s,n,e,r){const h=n/2;return e>=t&&e<=t+s&&r>=i-h&&r<=i+h}(t.tt,t.Jt.it,t.Jt.Ut,t.Jt.qt,i,s))||function(t,i,s){if(0===t.ln)return!1;switch(t.ir){case"arrowDown":case"arrowUp":return si(0,t.tt,t.it,t.ln,i,s);case"circle":return function(t,i,s,n,e){const r=2+Gt("circle",s)/2,h=t-n,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.tt,t.it,t.ln,i,s);case"square":return ti(t.tt,t.it,t.ln,i,s)}}(t,i,s)}function hi(t,i,s,n,e,r,h,l,a){const o=g(s)?s:s.An,_=g(s)?s:s.Nn,u=g(s)?s:s.Rn,c=g(i.size)?Math.max(i.size,0):1,d=Jt(l.wn())*c,f=d/2;if(t.ln=d,"number"==typeof i.position)return t.it=h.xt(i.position,a),void(void 0!==t.Jt&&(t.Jt.it=t.it+f+r+.6*e));switch(i.position){case"inBar":return t.it=h.xt(o,a),void(void 0!==t.Jt&&(t.Jt.it=t.it+f+r+.6*e));case"aboveBar":return t.it=h.xt(_,a)-f-n.sr,void 0!==t.Jt&&(t.Jt.it=t.it-f-.6*e,n.sr+=1.2*e),void(n.sr+=d+r);case"belowBar":return t.it=h.xt(u,a)+f+n.nr,void 0!==t.Jt&&(t.Jt.it=t.it+f+r+.6*e,n.nr+=1.2*e),void(n.nr+=d+r)}i.position}class li{constructor(t,i){this.ut=!0,this.er=!0,this.rr=!0,this.hr=null,this.Ft=new ni,this.Fe=t,this.gi=i,this.Nt={J:[],G:null}}dt(t){this.ut=!0,this.rr=!0,"data"===t&&(this.er=!0)}vt(t,i,s){if(!this.Fe.St())return null;this.ut&&this.tn();const n=this.gi.V().layout;return this.Ft.ue(n.fontSize,n.fontFamily),this.Ft.Z(this.Nt),this.Ft}lr(){if(this.rr){if(this.Fe.ar().length>0){const t=this.gi.gt().wn(),i=Qt(t),s=1.5*Jt(t)+2*i;this.hr={above:s,below:s}}else this.hr=null;this.rr=!1}return this.hr}tn(){const t=this.Fe.Ct(),i=this.gi.gt(),s=this.Fe.ar();this.er&&(this.Nt.J=s.map((t=>({rt:t.time,tt:0,it:0,ln:0,ir:t.shape,O:t.color,Je:t.internalId,Qe:t.id,Jt:void 0}))),this.er=!1);const n=this.gi.V().layout;this.Nt.G=null;const e=i.hn();if(null===e)return;const r=this.Fe.yt();if(null===r)return;if(0===this.Nt.J.length)return;let h=NaN;const l=Qt(i.wn()),a={sr:l,nr:l};this.Nt.G=vt(this.Nt.J,e,!0);for(let e=this.Nt.G.from;e<this.Nt.G.to;e++){const o=s[e];o.time!==h&&(a.sr=l,a.nr=l,h=o.time);const _=this.Nt.J[e];_.tt=i.Ot(o.time),void 0!==o.text&&o.text.length>0&&(_.Jt={tr:o.text,it:0,Ut:0,qt:0});const u=this.Fe._r(o.time);null!==u&&hi(_,o,u,a,n.fontSize,l,t,i,r.Tt)}this.ut=!1}}class ai extends $t{constructor(t){super(t)}Me(t,i){const s=this.be;s.St=!1;const n=this.Gs.V();if(!n.priceLineVisible||!this.Gs.St())return;const e=this.Gs.Ue(0===n.priceLineSource);e.qe||(s.St=!0,s.it=e.ti,s.O=this.Gs.ur(e.O),s.Ut=i,s.qt=t,s.Lt=n.priceLineWidth,s.Bt=n.priceLineStyle)}}class oi extends ${constructor(t){super(),this.zt=t}di(t,i,s){t.St=!1,i.St=!1;const n=this.zt;if(!n.St())return;const e=n.V(),r=e.lastValueVisible,h=""!==n.cr(),l=0===e.seriesLastValueMode,a=n.Ue(!1);if(a.qe)return;r&&(t.Jt=this.dr(a,r,l),t.St=0!==t.Jt.length),(h||l)&&(i.Jt=this.pr(a,r,h,l),i.St=i.Jt.length>0);const o=n.ur(a.O),_=m(o);s.t=_.t,s.O=_.i,s.ti=a.ti,i.Dt=n.jt().Pt(a.ti/n.Ct().qt()),t.Dt=o}pr(t,i,s,n){let e="";const r=this.zt.cr();return s&&0!==r.length&&(e+=`${r} `),i&&n&&(e+=this.zt.Ct().vr()?t.mr:t.wr),e.trim()}dr(t,i,s){return i?s?this.zt.Ct().vr()?t.wr:t.mr:t.Jt:""}}class _i{constructor(t,i){this.br=t,this.gr=i}Mr(t){return null!==t&&(this.br===t.br&&this.gr===t.gr)}Sr(){return new _i(this.br,this.gr)}yr(){return this.br}kr(){return this.gr}Cr(){return this.gr-this.br}vi(){return this.gr===this.br||Number.isNaN(this.gr)||Number.isNaN(this.br)}Ts(t){return null===t?this:new _i(Math.min(this.yr(),t.yr()),Math.max(this.kr(),t.kr()))}Tr(t){if(!g(t))return;if(0===this.gr-this.br)return;const i=.5*(this.gr+this.br);let s=this.gr-i,n=this.br-i;s*=t,n*=t,this.gr=i+s,this.br=i+n}Dr(t){g(t)&&(this.gr+=t,this.br+=t)}Pr(){return{minValue:this.br,maxValue:this.gr}}static Or(t){return null===t?null:new _i(t.minValue,t.maxValue)}}class ui{constructor(t,i){this.Nr=t,this.Rr=i||null}Ar(){return this.Nr}Er(){return this.Rr}Pr(){return null===this.Nr?null:{priceRange:this.Nr.Pr(),margins:this.Rr||void 0}}static Or(t){return null===t?null:new ui(_i.Or(t.priceRange),t.margins)}}class ci extends $t{constructor(t,i){super(t),this.Ir=i}Me(t,i){const s=this.be;s.St=!1;const n=this.Ir.V();if(!this.Gs.St()||!n.lineVisible)return;const e=this.Ir.Lr();null!==e&&(s.St=!0,s.it=e,s.O=n.color,s.Ut=i,s.qt=t,s.Lt=n.lineWidth,s.Bt=n.lineStyle)}}class di extends ${constructor(t,i){super(),this.Fe=t,this.Ir=i}di(t,i,s){t.St=!1,i.St=!1;const n=this.Ir.V(),e=n.axisLabelVisible,r=""!==n.title,h=this.Fe;if(!e||!h.St())return;const l=this.Ir.Lr();if(null===l)return;r&&(i.Jt=n.title,i.St=!0),i.Dt=h.jt().Pt(l/h.Ct().qt()),t.Jt=this.Br(n.price),t.St=!0;const a=m(n.color);s.t=a.t,s.O=a.i,s.ti=l}Br(t){const i=this.Fe.yt();return null===i?"":this.Fe.Ct().mi(t,i.Tt)}}class fi{constructor(t,i){this.Fe=t,this.Fi=i,this.Vr=new ci(t,this),this.ce=new di(t,this),this.Fr=new Wt(this.ce,t,t.jt())}zr(t){b(this.Fi,t),this.dt(),this.Fe.jt().Wr()}V(){return this.Fi}ss(){return[this.Vr,this.Fr]}jr(){return this.ce}dt(){this.Vr.dt(),this.ce.dt()}Lr(){const t=this.Fe,i=t.Ct();if(t.jt().gt().vi()||i.vi())return null;const s=t.yt();return null===s?null:i.xt(this.Fi.price,s.Tt)}}class pi extends X{constructor(t){super(),this.gi=t}jt(){return this.gi}}const vi={En:"",Zn:"",Kn:""};class mi{constructor(t){this.Fe=t}In(t,i){const s=this.Fe.$r(),n=this.Fe.V();switch(s){case"Line":return this.Hr(n,t,i);case"Area":return this.Ur(n);case"Baseline":return this.qr(n,t,i);case"Bar":return this.Yr(n,t,i);case"Candlestick":return this.Xr(n,t,i);case"Histogram":return this.Kr(n,t,i)}throw new Error("Unknown chart style")}Yr(t,i,s){const n=Object.assign({},vi),e=t.upColor,r=t.downColor,h=e,o=r,_=l(this.Zr(i,s)),u=a(_.Tt[0])<=a(_.Tt[3]);return void 0!==_.O?(n.En=_.O,n.Zn=_.O):(n.En=u?e:r,n.Zn=u?h:o),n}Xr(t,i,s){var n,e,r;const h=Object.assign({},vi),o=t.upColor,_=t.downColor,u=t.borderUpColor,c=t.borderDownColor,d=t.wickUpColor,f=t.wickDownColor,p=l(this.Zr(i,s)),v=a(p.Tt[0])<=a(p.Tt[3]);return h.En=null!==(n=p.O)&&void 0!==n?n:v?o:_,h.Zn=null!==(e=p.Dt)&&void 0!==e?e:v?u:c,h.Kn=null!==(r=p.Xn)&&void 0!==r?r:v?d:f,h}Ur(t){return Object.assign(Object.assign({},vi),{En:t.lineColor})}qr(t,i,s){const n=l(this.Zr(i,s)).Tt[3]>=t.baseValue.price;return Object.assign(Object.assign({},vi),{En:n?t.topLineColor:t.bottomLineColor})}Hr(t,i,s){var n;const e=l(this.Zr(i,s));return Object.assign(Object.assign({},vi),{En:null!==(n=e.O)&&void 0!==n?n:t.color})}Kr(t,i,s){const n=Object.assign({},vi),e=l(this.Zr(i,s));return n.En=void 0!==e.O?e.O:t.color,n}Zr(t,i){return void 0!==i?i.Tt:this.Fe._s().Gr(t)}}var wi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(wi||(wi={}));class bi{constructor(){this.Jr=[],this.Qr=new Map,this.th=new Map}ih(){return this.ln()>0?this.Jr[this.Jr.length-1]:null}sh(){return this.ln()>0?this.nh(0):null}os(){return this.ln()>0?this.nh(this.Jr.length-1):null}ln(){return this.Jr.length}vi(){return 0===this.ln()}Ye(t){return null!==this.eh(t,0)}Gr(t){return this.rh(t)}rh(t,i=0){const s=this.eh(t,i);return null===s?null:Object.assign(Object.assign({},this.hh(s)),{pn:this.nh(s)})}dn(){return this.Jr}lh(t,i,s){if(this.vi())return null;let n=null;for(const e of s){n=gi(n,this.ah(t,i,e))}return n}Z(t){this.th.clear(),this.Qr.clear(),this.Jr=t}nh(t){return this.Jr[t].pn}hh(t){return this.Jr[t]}eh(t,i){const s=this.oh(t);if(null===s&&0!==i)switch(i){case-1:return this._h(t);case 1:return this.uh(t);default:throw new TypeError("Unknown search mode")}return s}_h(t){let i=this.dh(t);return i>0&&(i-=1),i!==this.Jr.length&&this.nh(i)<t?i:null}uh(t){const i=this.fh(t);return i!==this.Jr.length&&t<this.nh(i)?i:null}oh(t){const i=this.dh(t);return i===this.Jr.length||t<this.Jr[i].pn?null:i}dh(t){return ct(this.Jr,t,((t,i)=>t.pn<i))}fh(t){return dt(this.Jr,t,((t,i)=>i.pn>t))}ph(t,i,s){let n=null;for(let e=t;e<i;e++){const t=this.Jr[e].Tt[s];Number.isNaN(t)||(null===n?n={mh:t,wh:t}:(t<n.mh&&(n.mh=t),t>n.wh&&(n.wh=t)))}return n}ah(t,i,s){if(this.vi())return null;let n=null;const e=l(this.sh()),r=l(this.os()),h=Math.max(t,e),a=Math.min(i,r),o=30*Math.ceil(h/30),_=Math.max(o,30*Math.floor(a/30));{const t=this.dh(h),e=this.fh(Math.min(a,o,i));n=gi(n,this.ph(t,e,s))}let u=this.Qr.get(s);void 0===u&&(u=new Map,this.Qr.set(s,u));for(let t=Math.max(o+1,h);t<_;t+=30){const i=Math.floor(t/30);let e=u.get(i);if(void 0===e){const t=this.dh(30*i),n=this.fh(30*(i+1)-1);e=this.ph(t,n,s),u.set(i,e)}n=gi(n,e)}{const t=this.dh(_),i=this.fh(a);n=gi(n,this.ph(t,i,s))}return n}}function gi(t,i){if(null===t)return i;if(null===i)return t;return{mh:Math.min(t.mh,i.mh),wh:Math.max(t.wh,i.wh)}}class Mi extends pi{constructor(t,i,s){super(t),this.Nt=new bi,this.Vr=new ai(this),this.bh=[],this.gh=new Ht(this),this.Mh=null,this.Sh=null,this.yh=[],this.kh=[],this.xh=null,this.Fi=i,this.Ch=s;const n=new oi(this);this.Ai=[n],this.Fr=new Wt(n,this,t),"Area"!==s&&"Line"!==s&&"Baseline"!==s||(this.Mh=new Kt(this)),this.Th(),this.Dh()}M(){null!==this.xh&&clearTimeout(this.xh)}ur(t){return this.Fi.priceLineColor||t}Ue(t){const i={qe:!0},s=this.Ct();if(this.jt().gt().vi()||s.vi()||this.Nt.vi())return i;const n=this.jt().gt().hn(),e=this.yt();if(null===n||null===e)return i;let r,h;if(t){const t=this.Nt.ih();if(null===t)return i;r=t,h=t.pn}else{const t=this.Nt.rh(n.Us(),-1);if(null===t)return i;if(r=this.Nt.Gr(t.pn),null===r)return i;h=t.pn}const l=r.Tt[3],a=this.cn().In(h,{Tt:r}),o=s.xt(l,e.Tt);return{qe:!1,ht:l,Jt:s.mi(l,e.Tt),mr:s.Ph(l),wr:s.Oh(l,e.Tt),O:a.En,ti:o,pn:h}}cn(){return null!==this.Sh||(this.Sh=new mi(this)),this.Sh}V(){return this.Fi}zr(t){const i=t.priceScaleId;void 0!==i&&i!==this.Fi.priceScaleId&&this.jt().Nh(this,i),b(this.Fi,t),void 0!==t.priceFormat&&(this.Th(),this.jt().Rh()),this.jt().Ah(this),this.jt().Eh(),this.qi.dt("options")}Z(t,i){this.Nt.Z(t),this.Ih(),this.qi.dt("data"),this.zi.dt("data"),null!==this.Mh&&(i&&i.Lh?this.Mh.We():0===t.length&&this.Mh.ze());const s=this.jt().fe(this);this.jt().Bh(s),this.jt().Ah(this),this.jt().Eh(),this.jt().Wr()}Vh(t){this.yh=t,this.Ih();const i=this.jt().fe(this);this.zi.dt("data"),this.jt().Bh(i),this.jt().Ah(this),this.jt().Eh(),this.jt().Wr()}Fh(){return this.yh}ar(){return this.kh}zh(t){const i=new fi(this,t);return this.bh.push(i),this.jt().Ah(this),i}Wh(t){const i=this.bh.indexOf(t);-1!==i&&this.bh.splice(i,1),this.jt().Ah(this)}$r(){return this.Ch}yt(){const t=this.jh();return null===t?null:{Tt:t.Tt[3],$h:t.rt}}jh(){const t=this.jt().gt().hn();if(null===t)return null;const i=t.Hs();return this.Nt.rh(i,1)}_s(){return this.Nt}_r(t){const i=this.Nt.Gr(t);return null===i?null:"Bar"===this.Ch||"Candlestick"===this.Ch?{On:i.Tt[0],Nn:i.Tt[1],Rn:i.Tt[2],An:i.Tt[3]}:i.Tt[3]}Hh(t){const i=this.Mh;return null!==i&&i.St()?(null===this.xh&&i.$e()&&(this.xh=setTimeout((()=>{this.xh=null,this.jt().Uh()}),0)),i.je(),[i]):[]}ss(){const t=[];this.qh()||t.push(this.gh),t.push(this.qi,this.Vr,this.Fr,this.zi);for(const i of this.bh)t.push(...i.ss());return t}ns(t,i){if(i!==this.yi&&!this.qh())return[];const s=[...this.Ai];for(const t of this.bh)s.push(t.jr());return s}Yh(t,i){if(void 0!==this.Fi.autoscaleInfoProvider){const s=this.Fi.autoscaleInfoProvider((()=>{const s=this.Xh(t,i);return null===s?null:s.Pr()}));return ui.Or(s)}return this.Xh(t,i)}Kh(){return this.Fi.priceFormat.minMove}Zh(){return this.Gh}rs(){var t;this.qi.dt(),this.zi.dt();for(const t of this.Ai)t.dt();for(const t of this.bh)t.dt();this.Vr.dt(),this.gh.dt(),null===(t=this.Mh)||void 0===t||t.dt()}Ct(){return l(super.Ct())}Mt(t){if(!(("Line"===this.Ch||"Area"===this.Ch||"Baseline"===this.Ch)&&this.Fi.crosshairMarkerVisible))return null;const i=this.Nt.Gr(t);if(null===i)return null;return{ht:i.Tt[3],nt:this.Jh(),Dt:this.Qh(),kt:this.tl(t)}}cr(){return this.Fi.title}St(){return this.Fi.visible}qh(){return!G(this.Ct().il())}Xh(t,i){if(!M(t)||!M(i)||this.Nt.vi())return null;const s="Line"===this.Ch||"Area"===this.Ch||"Baseline"===this.Ch||"Histogram"===this.Ch?[3]:[2,1],n=this.Nt.lh(t,i,s);let e=null!==n?new _i(n.mh,n.wh):null;if("Histogram"===this.$r()){const t=this.Fi.base,i=new _i(t,t);e=null!==e?e.Ts(i):i}return new ui(e,this.zi.lr())}Jh(){switch(this.Ch){case"Line":case"Area":case"Baseline":return this.Fi.crosshairMarkerRadius}return 0}Qh(){switch(this.Ch){case"Line":case"Area":case"Baseline":{const t=this.Fi.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}tl(t){switch(this.Ch){case"Line":case"Area":case"Baseline":{const t=this.Fi.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.cn().In(t).En}Th(){switch(this.Fi.priceFormat.type){case"custom":this.Gh={format:this.Fi.priceFormat.formatter};break;case"volume":this.Gh=new nt(this.Fi.priceFormat.precision);break;case"percent":this.Gh=new st(this.Fi.priceFormat.precision);break;default:{const t=Math.pow(10,this.Fi.priceFormat.precision);this.Gh=new it(t,this.Fi.priceFormat.minMove*t)}}null!==this.yi&&this.yi.sl()}Ih(){const t=this.jt().gt();if(t.vi()||0===this.Nt.ln())return void(this.kh=[]);const i=l(this.Nt.sh());this.kh=this.yh.map(((s,n)=>{const e=l(t.nl(s.time,!0)),r=e<i?1:-1;return{time:l(this.Nt.rh(e,r)).pn,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}}))}Dh(){switch(this.zi=new li(this,this.jt()),this.Ch){case"Bar":this.qi=new St(this,this.jt());break;case"Candlestick":this.qi=new Rt(this,this.jt());break;case"Line":this.qi=new Bt(this,this.jt());break;case"Area":this.qi=new bt(this,this.jt());break;case"Baseline":this.qi=new Ot(this,this.jt());break;case"Histogram":this.qi=new Lt(this,this.jt());break;default:throw Error("Unknown chart style assigned: "+this.Ch)}}}class Si{constructor(t){this.Fi=t}el(t,i,s){let n=t;if(0===this.Fi.mode)return n;const e=s.ji(),r=e.yt();if(null===r)return n;const h=e.xt(t,r),l=s.rl().filter((t=>t instanceof Mi)).reduce(((t,n)=>{if(s.pe(n)||!n.St())return t;const e=n.Ct(),r=n._s();if(e.vi()||!r.Ye(i))return t;const h=r.Gr(i);if(null===h)return t;const l=a(n.yt());return t.concat([e.xt(h.Tt[3],l.Tt)])}),[]);if(0===l.length)return n;l.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=l[0];return n=e.$i(o,r),n}}class yi{constructor(){this.Nt=null}Z(t){this.Nt=t}U(t,i,s,e){if(null===this.Nt)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r;const h=Math.ceil(this.Nt.It*i),a=Math.ceil(this.Nt.Et*i);!function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const s=l(this.Nt);if(s.hl){t.strokeStyle=s.ll,n(t,s.al),t.beginPath();for(const n of s.ol){const s=Math.round(n._l*i);t.moveTo(s,-r),t.lineTo(s,h+r)}t.stroke()}if(s.ul){t.strokeStyle=s.cl,n(t,s.dl),t.beginPath();for(const n of s.fl){const s=Math.round(n._l*i);t.moveTo(-r,s),t.lineTo(a+r,s)}t.stroke()}}))}}class ki{constructor(t){this.Ft=new yi,this.ut=!0,this.Pi=t}dt(){this.ut=!0}vt(t,i){if(this.ut){const s=this.Pi.jt().V().grid,n={It:t,Et:i,ul:s.horzLines.visible,hl:s.vertLines.visible,cl:s.horzLines.color,ll:s.vertLines.color,dl:s.horzLines.style,al:s.vertLines.style,fl:this.Pi.ji().pl(),ol:this.Pi.jt().gt().pl()||[]};this.Ft.Z(n),this.ut=!1}return this.Ft}}class xi{constructor(t){this.qi=new ki(t)}vl(){return this.qi}}const Ci={ml:4,wl:1e-4};function Ti(t,i){const s=100*(t-i)/i;return i<0?-s:s}function Di(t,i){const s=Ti(t.yr(),i),n=Ti(t.kr(),i);return new _i(s,n)}function Pi(t,i){const s=100*(t-i)/i+100;return i<0?-s:s}function Oi(t,i){const s=Pi(t.yr(),i),n=Pi(t.kr(),i);return new _i(s,n)}function Ni(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=xt(s+i.wl)+i.ml;return t<0?-n:n}function Ri(t,i){const s=Math.abs(t);if(s<1e-15)return 0;const n=Math.pow(10,s-i.ml)-i.wl;return t<0?-n:n}function Ai(t,i){if(null===t)return null;const s=Ni(t.yr(),i),n=Ni(t.kr(),i);return new _i(s,n)}function Ei(t,i){if(null===t)return null;const s=Ri(t.yr(),i),n=Ri(t.kr(),i);return new _i(s,n)}function Ii(t){if(null===t)return Ci;const i=Math.abs(t.kr()-t.yr());if(i>=1||i<1e-15)return Ci;const s=Math.ceil(Math.abs(Math.log10(i))),n=Ci.ml+s;return{ml:n,wl:1/Math.pow(10,n)}}class Li{constructor(t,i){if(this.bl=t,this.gl=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.bl))this.Ml=[2,2.5,2];else{this.Ml=[];for(let t=this.bl;1!==t;){if(t%2==0)this.Ml.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.Ml.push(2,2.5),t/=5}if(this.Ml.length>100)throw new Error("something wrong with base")}}}Sl(t,i,s){const n=0===this.bl?0:1/this.bl;let e=Math.pow(10,Math.max(0,Math.ceil(xt(t-i)))),r=0,h=this.gl[0];for(;;){const t=kt(e,n,1e-14)&&e>n+1e-14,i=kt(e,s*h,1e-14),l=kt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.gl[++r%this.gl.length]}if(e<=n+1e-14&&(e=n),e=Math.max(1,e),this.Ml.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.Ml[0];kt(e,s*h,1e-14)&&e>n+1e-14;)e/=h,h=this.Ml[++r%this.Ml.length];var l,a,o;return e}}class Bi{constructor(t,i,s,n){this.yl=[],this.fi=t,this.bl=i,this.kl=s,this.xl=n}Sl(t,i){if(t<i)throw new Error("high < low");const s=this.fi.qt(),n=(t-i)*this.Cl()/s,e=new Li(this.bl,[2,2.5,2]),r=new Li(this.bl,[2,2,2.5]),h=new Li(this.bl,[2.5,2,2]),l=[];return l.push(e.Sl(t,i,n),r.Sl(t,i,n),h.Sl(t,i,n)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let s=1;s<t.length;++s)t[s]<i&&(i=t[s]);return i}(l)}Tl(){const t=this.fi,i=t.yt();if(null===i)return void(this.yl=[]);const s=t.qt(),n=this.kl(s-1,i),e=this.kl(0,i),r=this.fi.V().entireTextOnly?this.Dl()/2:0,h=r,l=s-1-r,a=Math.max(n,e),o=Math.min(n,e);if(a===o)return void(this.yl=[]);let _=this.Sl(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let s=a-u;s>o;s-=_){const n=this.xl(s,i,!0);null!==d&&Math.abs(n-d)<this.Cl()||(n<h||n>l||(f<this.yl.length?(this.yl[f]._l=n,this.yl[f].Pl=t.Ol(s)):this.yl.push({_l:n,Pl:t.Ol(s)}),f++,d=n,t.Nl()&&(_=this.Sl(s*c,o))))}this.yl.length=f}pl(){return this.yl}Dl(){return this.fi.T()}Cl(){return Math.ceil(2.5*this.Dl())}}function Vi(t){return t.slice().sort(((t,i)=>l(t.xi())-l(i.xi())))}var Fi;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(Fi||(Fi={}));const zi=new st,Wi=new it(100,1);class ji{constructor(t,i,s,n){this.Rl=0,this.Al=null,this.Nr=null,this.El=null,this.Il={Ll:!1,Bl:null},this.Vl=0,this.Fl=0,this.zl=new w,this.Wl=new w,this.jl=[],this.$l=null,this.Hl=null,this.Ul=null,this.ql=null,this.Gh=Wi,this.Yl=Ii(null),this.Xl=t,this.Fi=i,this.Kl=s,this.Zl=n,this.Gl=new Bi(this,100,this.Jl.bind(this),this.Ql.bind(this))}il(){return this.Xl}V(){return this.Fi}zr(t){if(b(this.Fi,t),this.sl(),void 0!==t.mode&&this.ta({Se:t.mode}),void 0!==t.scaleMargins){const i=h(t.scaleMargins.top),s=h(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.ia(),this.Hl=null}}sa(){return this.Fi.autoScale}Nl(){return 1===this.Fi.mode}vr(){return 2===this.Fi.mode}na(){return 3===this.Fi.mode}Se(){return{vs:this.Fi.autoScale,ea:this.Fi.invertScale,Se:this.Fi.mode}}ta(t){const i=this.Se();let s=null;void 0!==t.vs&&(this.Fi.autoScale=t.vs),void 0!==t.Se&&(this.Fi.mode=t.Se,2!==t.Se&&3!==t.Se||(this.Fi.autoScale=!0),this.Il.Ll=!1),1===i.Se&&t.Se!==i.Se&&(!function(t,i){if(null===t)return!1;const s=Ri(t.yr(),i),n=Ri(t.kr(),i);return isFinite(s)&&isFinite(n)}(this.Nr,this.Yl)?this.Fi.autoScale=!0:(s=Ei(this.Nr,this.Yl),null!==s&&this.ra(s))),1===t.Se&&t.Se!==i.Se&&(s=Ai(this.Nr,this.Yl),null!==s&&this.ra(s));const n=i.Se!==this.Fi.mode;n&&(2===i.Se||this.vr())&&this.sl(),n&&(3===i.Se||this.na())&&this.sl(),void 0!==t.ea&&i.ea!==t.ea&&(this.Fi.invertScale=t.ea,this.ha()),this.Wl.m(i,this.Se())}la(){return this.Wl}T(){return this.Kl.fontSize}qt(){return this.Rl}aa(t){this.Rl!==t&&(this.Rl=t,this.ia(),this.Hl=null)}oa(){if(this.Al)return this.Al;const t=this.qt()-this._a()-this.ua();return this.Al=t,t}Ar(){return this.ca(),this.Nr}ra(t,i){const s=this.Nr;(i||null===s&&null!==t||null!==s&&!s.Mr(t))&&(this.Hl=null,this.Nr=t)}vi(){return this.ca(),0===this.Rl||!this.Nr||this.Nr.vi()}da(t){return this.ea()?t:this.qt()-1-t}xt(t,i){return this.vr()?t=Ti(t,i):this.na()&&(t=Pi(t,i)),this.Ql(t,i)}_n(t,i,s){this.ca();const n=this.ua(),e=l(this.Ar()),r=e.yr(),h=e.kr(),a=this.oa()-1,o=this.ea(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.fa();for(let s=u;s<c;s++){const e=t[s],h=e.ht;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e.ht,i));const a=n+_*(l-r),u=o?a:this.Rl-1-a;e.it=u}}Dn(t,i,s){this.ca();const n=this.ua(),e=l(this.Ar()),r=e.yr(),h=e.kr(),a=this.oa()-1,o=this.ea(),_=a/(h-r),u=void 0===s?0:s.from,c=void 0===s?t.length:s.to,d=this.fa();for(let s=u;s<c;s++){const e=t[s];let h=e.On,l=e.Nn,a=e.Rn,u=e.An;null!==d&&(h=d(e.On,i),l=d(e.Nn,i),a=d(e.Rn,i),u=d(e.An,i));let c=n+_*(h-r),f=o?c:this.Rl-1-c;e.Cn=f,c=n+_*(l-r),f=o?c:this.Rl-1-c,e.yn=f,c=n+_*(a-r),f=o?c:this.Rl-1-c,e.kn=f,c=n+_*(u-r),f=o?c:this.Rl-1-c,e.Tn=f}}$i(t,i){const s=this.Jl(t,i);return this.pa(s,i)}pa(t,i){let s=t;return this.vr()?s=function(t,i){return i<0&&(t=-t),t/100*i+i}(s,i):this.na()&&(s=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(s,i)),s}rl(){return this.jl}va(){if(this.$l)return this.$l;let t=[];for(let i=0;i<this.jl.length;i++){const s=this.jl[i];null===s.xi()&&s.Ci(i+1),t.push(s)}return t=Vi(t),this.$l=t,this.$l}ma(t){-1===this.jl.indexOf(t)&&(this.jl.push(t),this.sl(),this.wa())}ba(t){const i=this.jl.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.jl.splice(i,1),0===this.jl.length&&(this.ta({vs:!0}),this.ra(null)),this.sl(),this.wa()}yt(){let t=null;for(const i of this.jl){const s=i.yt();null!==s&&((null===t||s.$h<t.$h)&&(t=s))}return null===t?null:t.Tt}ea(){return this.Fi.invertScale}pl(){const t=null===this.yt();if(null!==this.Hl&&(t||this.Hl.ga===t))return this.Hl.pl;this.Gl.Tl();const i=this.Gl.pl();return this.Hl={pl:i,ga:t},this.zl.m(),i}Ma(){return this.zl}Sa(t){this.vr()||this.na()||null===this.Ul&&null===this.El&&(this.vi()||(this.Ul=this.Rl-t,this.El=l(this.Ar()).Sr()))}ya(t){if(this.vr()||this.na())return;if(null===this.Ul)return;this.ta({vs:!1}),(t=this.Rl-t)<0&&(t=0);let i=(this.Ul+.2*(this.Rl-1))/(t+.2*(this.Rl-1));const s=l(this.El).Sr();i=Math.max(i,.1),s.Tr(i),this.ra(s)}ka(){this.vr()||this.na()||(this.Ul=null,this.El=null)}xa(t){this.sa()||null===this.ql&&null===this.El&&(this.vi()||(this.ql=t,this.El=l(this.Ar()).Sr()))}Ca(t){if(this.sa())return;if(null===this.ql)return;const i=l(this.Ar()).Cr()/(this.oa()-1);let s=t-this.ql;this.ea()&&(s*=-1);const n=s*i,e=l(this.El).Sr();e.Dr(n),this.ra(e,!0),this.Hl=null}Ta(){this.sa()||null!==this.ql&&(this.ql=null,this.El=null)}Zh(){return this.Gh||this.sl(),this.Gh}mi(t,i){switch(this.Fi.mode){case 2:return this.Zh().format(Ti(t,i));case 3:return this.Zh().format(Pi(t,i));default:return this.Br(t)}}Ol(t){switch(this.Fi.mode){case 2:case 3:return this.Zh().format(t);default:return this.Br(t)}}Ph(t){return this.Br(t,l(this.Da()).Zh())}Oh(t,i){return t=Ti(t,i),zi.format(t)}Pa(){return this.jl}Oa(t){this.Il={Bl:t,Ll:!1}}rs(){this.jl.forEach((t=>t.rs()))}sl(){this.Hl=null;const t=this.Da();let i=100;null!==t&&(i=Math.round(1/t.Kh())),this.Gh=Wi,this.vr()?(this.Gh=zi,i=100):this.na()?(this.Gh=new it(100,1),i=100):null!==t&&(this.Gh=t.Zh()),this.Gl=new Bi(this,i,this.Jl.bind(this),this.Ql.bind(this)),this.Gl.Tl()}wa(){this.$l=null}Da(){return this.jl[0]||null}_a(){return this.ea()?this.Fi.scaleMargins.bottom*this.qt()+this.Fl:this.Fi.scaleMargins.top*this.qt()+this.Vl}ua(){return this.ea()?this.Fi.scaleMargins.top*this.qt()+this.Vl:this.Fi.scaleMargins.bottom*this.qt()+this.Fl}ca(){this.Il.Ll||(this.Il.Ll=!0,this.Na())}ia(){this.Al=null}Ql(t,i){if(this.ca(),this.vi())return 0;t=this.Nl()&&t?Ni(t,this.Yl):t;const s=l(this.Ar()),n=this.ua()+(this.oa()-1)*(t-s.yr())/s.Cr();return this.da(n)}Jl(t,i){if(this.ca(),this.vi())return 0;const s=this.da(t),n=l(this.Ar()),e=n.yr()+n.Cr()*((s-this.ua())/(this.oa()-1));return this.Nl()?Ri(e,this.Yl):e}ha(){this.Hl=null,this.Gl.Tl()}Na(){const t=this.Il.Bl;if(null===t)return;let i=null;const s=this.Pa();let n=0,e=0;for(const r of s){if(!r.St())continue;const s=r.yt();if(null===s)continue;const h=r.Yh(t.Hs(),t.Us());let a=h&&h.Ar();if(null!==a){switch(this.Fi.mode){case 1:a=Ai(a,this.Yl);break;case 2:a=Di(a,s.Tt);break;case 3:a=Oi(a,s.Tt)}if(i=null===i?a:i.Ts(l(a)),null!==h){const t=h.Er();null!==t&&(n=Math.max(n,t.above),e=Math.max(n,t.below))}}}if(n===this.Vl&&e===this.Fl||(this.Vl=n,this.Fl=e,this.Hl=null,this.ia()),null!==i){if(i.yr()===i.kr()){const t=this.Da(),s=5*(null===t||this.vr()||this.na()?1:t.Kh());this.Nl()&&(i=Ei(i,this.Yl)),i=new _i(i.yr()-s,i.kr()+s),this.Nl()&&(i=Ai(i,this.Yl))}if(this.Nl()){const t=Ei(i,this.Yl),s=Ii(t);if(r=s,h=this.Yl,r.ml!==h.ml||r.wl!==h.wl){const n=null!==this.El?Ei(this.El,this.Yl):null;this.Yl=s,i=Ai(t,s),null!==n&&(this.El=Ai(n,s))}}this.ra(i)}else null===this.Nr&&(this.ra(new _i(-.5,.5)),this.Yl=Ii(null));var r,h;this.Il.Ll=!0}fa(){return this.vr()?Ti:this.na()?Pi:this.Nl()?t=>Ni(t,this.Yl):null}Br(t,i){return void 0===this.Zl.priceFormatter?(void 0===i&&(i=this.Zh()),i.format(t)):this.Zl.priceFormatter(t)}}class $i{constructor(t,i){this.jl=[],this.Ra=new Map,this.Rl=0,this.oe=0,this.Aa=1e3,this.$l=null,this.Ea=new w,this.Ia=t,this.gi=i,this.La=new xi(this);const s=i.V();this.Ba=this.Va("left",s.leftPriceScale),this.Fa=this.Va("right",s.rightPriceScale),this.Ba.la().l(this.za.bind(this,this.Ba),this),this.Fa.la().l(this.za.bind(this,this.Fa),this),this.Wa(s)}Wa(t){if(t.leftPriceScale&&this.Ba.zr(t.leftPriceScale),t.rightPriceScale&&this.Fa.zr(t.rightPriceScale),t.localization&&(this.Ba.sl(),this.Fa.sl()),t.overlayPriceScales){const i=Array.from(this.Ra.values());for(const s of i){const i=l(s[0].Ct());i.zr(t.overlayPriceScales),t.localization&&i.sl()}}}ja(t){switch(t){case"left":return this.Ba;case"right":return this.Fa}return this.Ra.has(t)?h(this.Ra.get(t))[0].Ct():null}M(){this.jt().$a().v(this),this.Ba.la().v(this),this.Fa.la().v(this),this.jl.forEach((t=>{t.M&&t.M()})),this.Ea.m()}Ha(){return this.Aa}Ua(t){this.Aa=t}jt(){return this.gi}Ut(){return this.oe}qt(){return this.Rl}qa(t){this.oe=t,this.Ya()}aa(t){this.Rl=t,this.Ba.aa(t),this.Fa.aa(t),this.jl.forEach((i=>{if(this.pe(i)){const s=i.Ct();null!==s&&s.aa(t)}})),this.Ya()}rl(){return this.jl}pe(t){const i=t.Ct();return null===i||this.Ba!==i&&this.Fa!==i}ma(t,i,s){const n=void 0!==s?s:this.Ka().Xa+1;this.Za(t,i,n)}ba(t){const i=this.jl.indexOf(t);r(-1!==i,"removeDataSource: invalid data source"),this.jl.splice(i,1);const s=l(t.Ct()).il();if(this.Ra.has(s)){const i=h(this.Ra.get(s)),n=i.indexOf(t);-1!==n&&(i.splice(n,1),0===i.length&&this.Ra.delete(s))}const n=t.Ct();n&&n.rl().indexOf(t)>=0&&n.ba(t),null!==n&&(n.wa(),this.Ga(n)),this.$l=null}me(t){return t===this.Ba?"left":t===this.Fa?"right":"overlay"}Ja(){return this.Ba}Qa(){return this.Fa}io(t,i){t.Sa(i)}so(t,i){t.ya(i),this.Ya()}no(t){t.ka()}eo(t,i){t.xa(i)}ro(t,i){t.Ca(i),this.Ya()}ho(t){t.Ta()}Ya(){this.jl.forEach((t=>{t.rs()}))}ji(){let t=null;return this.gi.V().rightPriceScale.visible&&0!==this.Fa.rl().length?t=this.Fa:this.gi.V().leftPriceScale.visible&&0!==this.Ba.rl().length?t=this.Ba:0!==this.jl.length&&(t=this.jl[0].Ct()),null===t&&(t=this.Fa),t}ve(){let t=null;return this.gi.V().rightPriceScale.visible?t=this.Fa:this.gi.V().leftPriceScale.visible&&(t=this.Ba),t}Ga(t){null!==t&&t.sa()&&this.lo(t)}ao(t){const i=this.Ia.hn();t.ta({vs:!0}),null!==i&&t.Oa(i),this.Ya()}oo(){this.lo(this.Ba),this.lo(this.Fa)}_o(){this.Ga(this.Ba),this.Ga(this.Fa),this.jl.forEach((t=>{this.pe(t)&&this.Ga(t.Ct())})),this.Ya(),this.gi.Wr()}va(){return null===this.$l&&(this.$l=Vi(this.jl)),this.$l}uo(){return this.Ea}co(){return this.La}lo(t){const i=t.Pa();if(i&&i.length>0&&!this.Ia.vi()){const i=this.Ia.hn();null!==i&&t.Oa(i)}t.rs()}Ka(){const t=this.va();if(0===t.length)return{do:0,Xa:0};let i=0,s=0;for(let n=0;n<t.length;n++){const e=t[n].xi();null!==e&&(e<i&&(i=e),e>s&&(s=e))}return{do:i,Xa:s}}Za(t,i,s){let n=this.ja(i);if(null===n&&(n=this.Va(i,this.gi.V().overlayPriceScales)),this.jl.push(t),!G(i)){const s=this.Ra.get(i)||[];s.push(t),this.Ra.set(i,s)}n.ma(t),t.Ti(n),t.Ci(s),this.Ga(n),this.$l=null}za(t,i,s){i.Se!==s.Se&&this.lo(t)}Va(t,i){const s=Object.assign({visible:!0,autoScale:!0},k(i)),n=new ji(t,s,this.gi.V().layout,this.gi.V().localization);return n.aa(this.qt()),n}}const Hi=t=>t.getUTCFullYear();function Ui(t,i,s){return i.replace(/yyyy/g,(t=>tt(Hi(t),4))(t)).replace(/yy/g,(t=>tt(Hi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,s)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,s)).replace(/MM/g,(t=>tt((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>tt((t=>t.getUTCDate())(t),2))(t))}class qi{constructor(t="yyyy-MM-dd",i="default"){this.fo=t,this.po=i}vo(t){return Ui(t,this.fo,this.po)}}class Yi{constructor(t){this.mo=t||"%h:%m:%s"}vo(t){return this.mo.replace("%h",tt(t.getUTCHours(),2)).replace("%m",tt(t.getUTCMinutes(),2)).replace("%s",tt(t.getUTCSeconds(),2))}}const Xi={wo:"yyyy-MM-dd",bo:"%h:%m:%s",Mo:" ",So:"default"};class Ki{constructor(t={}){const i=Object.assign(Object.assign({},Xi),t);this.yo=new qi(i.wo,i.So),this.ko=new Yi(i.bo),this.xo=i.Mo}vo(t){return`${this.yo.vo(t)}${this.xo}${this.ko.vo(t)}`}}class Zi{constructor(t,i=50){this.Co=0,this.To=1,this.Do=1,this.ne=new Map,this.Po=new Map,this.Oo=t,this.No=i}vo(t){const i=t.rt,s=void 0===i.Ro?new Date(1e3*i.Ao).getTime():new Date(Date.UTC(i.Ro.year,i.Ro.month-1,i.Ro.day)).getTime(),n=this.ne.get(s);if(void 0!==n)return n.Eo;if(this.Co===this.No){const t=this.Po.get(this.Do);this.Po.delete(this.Do),this.ne.delete(h(t)),this.Do++,this.Co--}const e=this.Oo(t);return this.ne.set(s,{Eo:e,Io:this.To}),this.Po.set(this.To,s),this.Co++,this.To++,e}}class Gi{constructor(t,i){r(t<=i,"right should be >= left"),this.Lo=t,this.Bo=i}Hs(){return this.Lo}Us(){return this.Bo}Vo(){return this.Bo-this.Lo+1}Ye(t){return this.Lo<=t&&t<=this.Bo}Mr(t){return this.Lo===t.Hs()&&this.Bo===t.Us()}}function Ji(t,i){return null===t||null===i?t===i:t.Mr(i)}class Qi{constructor(){this.Fo=new Map,this.ne=null}zo(t,i){this.Wo(i),this.ne=null;for(let s=i;s<t.length;++s){const i=t[s];let n=this.Fo.get(i.jo);void 0===n&&(n=[],this.Fo.set(i.jo,n)),n.push({pn:s,rt:i.rt,$o:i.jo,Ho:i.Ho})}}Uo(t,i){const s=Math.ceil(i/t);return null!==this.ne&&this.ne.qo===s||(this.ne={pl:this.Yo(s),qo:s}),this.ne.pl}Wo(t){if(0===t)return void this.Fo.clear();const i=[];this.Fo.forEach(((s,n)=>{t<=s[0].pn?i.push(n):s.splice(ct(s,t,(i=>i.pn<t)),1/0)}));for(const t of i)this.Fo.delete(t)}Yo(t){let i=[];for(const s of Array.from(this.Fo.keys()).sort(((t,i)=>i-t))){if(!this.Fo.get(s))continue;const n=i;i=[];const e=n.length;let r=0;const l=h(this.Fo.get(s)),a=l.length;let o=1/0,_=-1/0;for(let s=0;s<a;s++){const h=l[s],a=h.pn;for(;r<e;){const t=n[r],s=t.pn;if(!(s<a)){o=s;break}r++,i.push(t),_=s,o=1/0}o-a>=t&&a-_>=t&&(i.push(h),_=a)}for(;r<e;r++)i.push(n[r])}return i}}class ts{constructor(t){this.Xo=t}Ko(){return null===this.Xo?null:new Gi(Math.floor(this.Xo.Hs()),Math.ceil(this.Xo.Us()))}Zo(){return this.Xo}static Go(){return new ts(null)}}var is,ss,ns,es,rs;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(is||(is={}));class hs{constructor(t,i,s){this.oe=0,this.Jo=null,this.Qo=[],this.ql=null,this.Ul=null,this.t_=new Qi,this.i_=new Map,this.s_=ts.Go(),this.n_=!0,this.e_=new w,this.r_=new w,this.h_=new w,this.l_=null,this.a_=null,this.o_=[],this.Fi=i,this.Zl=s,this.__=i.rightOffset,this.u_=i.barSpacing,this.gi=t,this.c_()}V(){return this.Fi}d_(t){b(this.Zl,t),this.f_(),this.c_()}zr(t,i){var s;b(this.Fi,t),this.Fi.fixLeftEdge&&this.p_(),this.Fi.fixRightEdge&&this.v_(),void 0!==t.barSpacing&&this.gi.ks(t.barSpacing),void 0!==t.rightOffset&&this.gi.xs(t.rightOffset),void 0!==t.minBarSpacing&&this.gi.ks(null!==(s=t.barSpacing)&&void 0!==s?s:this.u_),this.f_(),this.c_(),this.h_.m()}Hi(t){var i,s;return null!==(s=null===(i=this.Qo[t])||void 0===i?void 0:i.rt)&&void 0!==s?s:null}Mi(t){var i;return null!==(i=this.Qo[t])&&void 0!==i?i:null}nl(t,i){if(this.Qo.length<1)return null;if(t.Ao>this.Qo[this.Qo.length-1].rt.Ao)return i?this.Qo.length-1:null;const s=ct(this.Qo,t.Ao,((t,i)=>t.rt.Ao<i));return t.Ao<this.Qo[s].rt.Ao?i?s:null:s}vi(){return 0===this.oe||0===this.Qo.length||null===this.Jo}hn(){return this.m_(),this.s_.Ko()}w_(){return this.m_(),this.s_.Zo()}b_(){const t=this.hn();if(null===t)return null;const i={from:t.Hs(),to:t.Us()};return this.g_(i)}g_(t){const i=Math.round(t.from),s=Math.round(t.to),n=l(this.M_()),e=l(this.S_());return{from:l(this.Hi(Math.max(n,i))),to:l(this.Hi(Math.min(e,s)))}}y_(t){return{from:l(this.nl(t.from,!0)),to:l(this.nl(t.to,!0))}}Ut(){return this.oe}qa(t){if(!isFinite(t)||t<=0)return;if(this.oe===t)return;const i=this.w_(),s=this.oe;if(this.oe=t,this.n_=!0,this.Fi.lockVisibleTimeRangeOnResize&&0!==s){const i=this.u_*t/s;this.u_=i}if(this.Fi.fixLeftEdge&&null!==i&&i.Hs()<=0){const i=s-t;this.__-=Math.round(i/this.u_)+1,this.n_=!0}this.k_(),this.x_()}Ot(t){if(this.vi()||!M(t))return 0;const i=this.C_()+this.__-t;return this.oe-(i+.5)*this.u_-1}on(t,i){const s=this.C_(),n=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=n;i<e;i++){const n=t[i].rt,e=s+this.__-n,r=this.oe-(e+.5)*this.u_-1;t[i].tt=r}}T_(t){return Math.ceil(this.D_(t))}xs(t){this.n_=!0,this.__=t,this.x_(),this.gi.P_(),this.gi.Wr()}wn(){return this.u_}ks(t){this.O_(t),this.x_(),this.gi.P_(),this.gi.Wr()}N_(){return this.__}pl(){if(this.vi())return null;if(null!==this.a_)return this.a_;const t=this.u_,i=5*(this.gi.V().layout.fontSize+4),s=Math.round(i/t),n=l(this.hn()),e=Math.max(n.Hs(),n.Hs()-s),r=Math.max(n.Us(),n.Us()-s),h=this.t_.Uo(t,i),a=this.M_()+s,o=this.S_()-s,_=this.R_(),u=this.Fi.fixLeftEdge||_,c=this.Fi.fixRightEdge||_;let d=0;for(const t of h){if(!(e<=t.pn&&t.pn<=r))continue;let s;d<this.o_.length?(s=this.o_[d],s._l=this.Ot(t.pn),s.Pl=this.A_(t),s.$o=t.$o):(s={E_:!1,_l:this.Ot(t.pn),Pl:this.A_(t),$o:t.$o},this.o_.push(s)),this.u_>i/2&&!_?s.E_=!1:s.E_=u&&t.pn<=a||c&&t.pn>=o,d++}return this.o_.length=d,this.a_=this.o_,this.o_}I_(){this.n_=!0,this.ks(this.Fi.barSpacing),this.xs(this.Fi.rightOffset)}L_(t){this.n_=!0,this.Jo=t,this.x_(),this.p_()}B_(t,i){const s=this.D_(t),n=this.wn(),e=n+i*(n/10);this.ks(e),this.Fi.rightBarStaysOnScroll||this.xs(this.N_()+(s-this.D_(t)))}Sa(t){this.ql&&this.Ta(),null===this.Ul&&null===this.l_&&(this.vi()||(this.Ul=t,this.V_()))}ya(t){if(null===this.l_)return;const i=yt(this.oe-t,0,this.oe),s=yt(this.oe-l(this.Ul),0,this.oe);0!==i&&0!==s&&this.ks(this.l_.wn*i/s)}ka(){null!==this.Ul&&(this.Ul=null,this.F_())}xa(t){null===this.ql&&null===this.l_&&(this.vi()||(this.ql=t,this.V_()))}Ca(t){if(null===this.ql)return;const i=(this.ql-t)/this.wn();this.__=l(this.l_).N_+i,this.n_=!0,this.x_()}Ta(){null!==this.ql&&(this.ql=null,this.F_())}z_(){this.W_(this.Fi.rightOffset)}W_(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.__,n=performance.now(),e=()=>{const r=(performance.now()-n)/i,h=r>=1,l=h?t:s+(t-s)*r;this.xs(l),h||setTimeout(e,20)};e()}dt(t,i){this.n_=!0,this.Qo=t,this.t_.zo(t,i),this.x_()}j_(){return this.e_}H_(){return this.r_}U_(){return this.h_}C_(){return this.Jo||0}q_(t){const i=t.Vo();this.O_(this.oe/i),this.__=t.Us()-this.C_(),this.x_(),this.n_=!0,this.gi.P_(),this.gi.Wr()}Y_(){const t=this.M_(),i=this.S_();null!==t&&null!==i&&this.q_(new Gi(t,i+this.Fi.rightOffset))}X_(t){const i=new Gi(t.from,t.to);this.q_(i)}Si(t){return void 0!==this.Zl.timeFormatter?this.Zl.timeFormatter(t.Ho):this.K_.vo(new Date(1e3*t.rt.Ao))}R_(){const{handleScroll:t,handleScale:i}=this.gi.V();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}M_(){return 0===this.Qo.length?null:0}S_(){return 0===this.Qo.length?null:this.Qo.length-1}Z_(t){return(this.oe-1-t)/this.u_}D_(t){const i=this.Z_(t),s=this.C_()+this.__-i;return Math.round(1e6*s)/1e6}O_(t){const i=this.u_;this.u_=t,this.k_(),i!==this.u_&&(this.n_=!0,this.G_())}m_(){if(!this.n_)return;if(this.n_=!1,this.vi())return void this.J_(ts.Go());const t=this.C_(),i=this.oe/this.u_,s=this.__+t,n=new Gi(s-i+1,s);this.J_(new ts(n))}k_(){const t=this.Q_();if(this.u_<t&&(this.u_=t,this.n_=!0),0!==this.oe){const t=.5*this.oe;this.u_>t&&(this.u_=t,this.n_=!0)}}Q_(){return this.Fi.fixLeftEdge&&this.Fi.fixRightEdge&&0!==this.Qo.length?this.oe/this.Qo.length:this.Fi.minBarSpacing}x_(){const t=this.tu();this.__>t&&(this.__=t,this.n_=!0);const i=this.iu();null!==i&&this.__<i&&(this.__=i,this.n_=!0)}iu(){const t=this.M_(),i=this.Jo;if(null===t||null===i)return null;return t-i-1+(this.Fi.fixLeftEdge?this.oe/this.u_:Math.min(2,this.Qo.length))}tu(){return this.Fi.fixRightEdge?0:this.oe/this.u_-Math.min(2,this.Qo.length)}V_(){this.l_={wn:this.wn(),N_:this.N_()}}F_(){this.l_=null}A_(t){let i=this.i_.get(t.$o);return void 0===i&&(i=new Zi((t=>this.su(t))),this.i_.set(t.$o,i)),i.vo(t)}su(t){const i=function(t,i,s){switch(t){case 0:case 10:return i?s?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.$o,this.Fi.timeVisible,this.Fi.secondsVisible);return void 0!==this.Fi.tickMarkFormatter?this.Fi.tickMarkFormatter(t.Ho,i,this.Zl.locale):function(t,i,s){const n={};switch(i){case 0:n.year="numeric";break;case 1:n.month="short";break;case 2:n.day="numeric";break;case 3:n.hour12=!1,n.hour="2-digit",n.minute="2-digit";break;case 4:n.hour12=!1,n.hour="2-digit",n.minute="2-digit",n.second="2-digit"}const e=void 0===t.Ro?new Date(1e3*t.Ao):new Date(Date.UTC(t.Ro.year,t.Ro.month-1,t.Ro.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(s,n)}(t.rt,i,this.Zl.locale)}J_(t){const i=this.s_;this.s_=t,Ji(i.Ko(),this.s_.Ko())||this.e_.m(),Ji(i.Zo(),this.s_.Zo())||this.r_.m(),this.G_()}G_(){this.a_=null}f_(){this.G_(),this.i_.clear()}c_(){const t=this.Zl.dateFormat;this.Fi.timeVisible?this.K_=new Ki({wo:t,bo:this.Fi.secondsVisible?"%h:%m:%s":"%h:%m",Mo:"   ",So:this.Zl.locale}):this.K_=new qi(t,this.Zl.locale)}p_(){if(!this.Fi.fixLeftEdge)return;const t=this.M_();if(null===t)return;const i=this.hn();if(null===i)return;const s=i.Hs()-t;if(s<0){const t=this.__-s-1;this.xs(t)}this.k_()}v_(){this.x_(),this.k_()}}class ls extends N{constructor(t){super(),this.nu=new Map,this.Nt=t}q(t){}X(t){if(!this.Nt.St)return;t.save();let i=0;for(const s of this.Nt.eu){if(0===s.Jt.length)continue;t.font=s.D;const n=this.ru(t,s.Jt);n>this.Nt.Ut?s.B_=this.Nt.Ut/n:s.B_=1,i+=s.hu*s.B_}let s=0;switch(this.Nt.lu){case"top":s=0;break;case"center":s=Math.max((this.Nt.qt-i)/2,0);break;case"bottom":s=Math.max(this.Nt.qt-i,0)}t.fillStyle=this.Nt.O;for(const i of this.Nt.eu){t.save();let n=0;switch(this.Nt.au){case"left":t.textAlign="left",n=i.hu/2;break;case"center":t.textAlign="center",n=this.Nt.Ut/2;break;case"right":t.textAlign="right",n=this.Nt.Ut-1-i.hu/2}t.translate(n,s),t.textBaseline="top",t.font=i.D,t.scale(i.B_,i.B_),t.fillText(i.Jt,0,i.ou),t.restore(),s+=i.hu*i.B_}t.restore()}ru(t,i){const s=this._u(t.font);let n=s.get(i);return void 0===n&&(n=t.measureText(i).width,s.set(i,n)),n}_u(t){let i=this.nu.get(t);return void 0===i&&(i=new Map,this.nu.set(t,i)),i}}class as{constructor(t){this.ut=!0,this.Vt={St:!1,O:"",qt:0,Ut:0,eu:[],lu:"center",au:"center"},this.Ft=new ls(this.Vt),this.zt=t}dt(){this.ut=!0}vt(t,i){return this.ut&&(this.wt(t,i),this.ut=!1),this.Ft}wt(t,i){const s=this.zt.V(),n=this.Vt;n.St=s.visible,n.St&&(n.O=s.color,n.Ut=i,n.qt=t,n.au=s.horzAlign,n.lu=s.vertAlign,n.eu=[{Jt:s.text,D:D(s.fontSize,s.fontFamily,s.fontStyle),hu:1.2*s.fontSize,ou:0,B_:0}])}}class os extends X{constructor(t,i){super(),this.Fi=i,this.qi=new as(this)}ns(){return[]}ss(){return[this.qi]}V(){return this.Fi}rs(){this.qi.dt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(ss||(ss={}));class _s{constructor(t,i){this.uu=[],this.cu=[],this.oe=0,this.du=null,this.fu=null,this.pu=new w,this.vu=new w,this.mu=null,this.wu=t,this.Fi=i,this.bu=new P(this),this.Ia=new hs(this,i.timeScale,this.Fi.localization),this.ct=new Z(this,i.crosshair),this.gu=new Si(i.crosshair),this.Mu=new os(this,i.watermark),this.Su(),this.uu[0].Ua(2e3),this.yu=this.ku(0),this.xu=this.ku(1)}Rh(){this.Cu(new J(3))}Wr(){this.Cu(new J(2))}Uh(){this.Cu(new J(1))}Ah(t){const i=this.Tu(t);this.Cu(i)}Du(){return this.fu}Pu(t){const i=this.fu;this.fu=t,null!==i&&this.Ah(i.Ou),null!==t&&this.Ah(t.Ou)}V(){return this.Fi}zr(t){b(this.Fi,t),this.uu.forEach((i=>i.Wa(t))),void 0!==t.timeScale&&this.Ia.zr(t.timeScale),void 0!==t.localization&&this.Ia.d_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.pu.m(),this.yu=this.ku(0),this.xu=this.ku(1),this.Rh()}Nu(t,i){if("left"===t)return void this.zr({leftPriceScale:i});if("right"===t)return void this.zr({rightPriceScale:i});const s=this.Ru(t);null!==s&&(s.Ct.zr(i),this.pu.m())}Ru(t){for(const i of this.uu){const s=i.ja(t);if(null!==s)return{Wt:i,Ct:s}}return null}gt(){return this.Ia}Au(){return this.uu}Eu(){return this.Mu}Iu(){return this.ct}Lu(){return this.vu}Bu(t,i){t.aa(i),this.P_()}qa(t){this.oe=t,this.Ia.qa(this.oe),this.uu.forEach((i=>i.qa(t))),this.P_()}Su(t){const i=new $i(this.Ia,this);void 0!==t?this.uu.splice(t,0,i):this.uu.push(i);const s=void 0===t?this.uu.length-1:t,n=new J(3);return n.fs(s,{ps:0,vs:!0}),this.Cu(n),i}io(t,i,s){t.io(i,s)}so(t,i,s){t.so(i,s),this.Eh(),this.Cu(this.Vu(t,2))}no(t,i){t.no(i),this.Cu(this.Vu(t,2))}eo(t,i,s){i.sa()||t.eo(i,s)}ro(t,i,s){i.sa()||(t.ro(i,s),this.Eh(),this.Cu(this.Vu(t,2)))}ho(t,i){i.sa()||(t.ho(i),this.Cu(this.Vu(t,2)))}ao(t,i){t.ao(i),this.Cu(this.Vu(t,2))}Fu(t){this.Ia.Sa(t)}zu(t,i){const s=this.gt();if(s.vi()||0===i)return;const n=s.Ut();t=Math.max(1,Math.min(t,n)),s.B_(t,i),this.P_()}Wu(t){this.ju(0),this.$u(t),this.Hu()}Uu(t){this.Ia.ya(t),this.P_()}qu(){this.Ia.ka(),this.Wr()}ju(t){this.du=t,this.Ia.xa(t)}$u(t){let i=!1;return null!==this.du&&Math.abs(t-this.du)>20&&(this.du=null,i=!0),this.Ia.Ca(t),this.P_(),i}Hu(){this.Ia.Ta(),this.Wr(),this.du=null}ft(){return this.cu}Yu(t,i,s){this.ct.Yi(t,i);let n=NaN,e=this.Ia.T_(t);const r=this.Ia.hn();null!==r&&(e=Math.min(Math.max(r.Hs(),e),r.Us()));const h=s.ji(),l=h.yt();null!==l&&(n=h.$i(i,l)),n=this.gu.el(n,e,s),this.ct.Gi(e,n,s),this.Uh(),this.vu.m(this.ct.bt(),{x:t,y:i})}Xu(){this.Iu().Qi(),this.Uh(),this.vu.m(null,null)}Eh(){const t=this.ct.Wt();if(null!==t){const i=this.ct.Ki(),s=this.ct.Zi();this.Yu(i,s,t)}this.ct.rs()}Ku(t,i,s){const n=this.Ia.Hi(0);void 0!==i&&void 0!==s&&this.Ia.dt(i,s);const e=this.Ia.Hi(0),r=this.Ia.C_(),h=this.Ia.hn();if(null!==h&&null!==n&&null!==e){const i=h.Ye(r),s=n.Ao>e.Ao,l=null!==t&&t>r&&!s,a=i&&this.Ia.V().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.Ia.xs(this.Ia.N_()-i)}}this.Ia.L_(t)}Bh(t){null!==t&&t._o()}fe(t){const i=this.uu.find((i=>i.va().includes(t)));return void 0===i?null:i}P_(){this.Mu.rs(),this.uu.forEach((t=>t._o())),this.Eh()}M(){this.uu.forEach((t=>t.M())),this.uu.length=0,this.Fi.localization.priceFormatter=void 0,this.Fi.localization.timeFormatter=void 0}Zu(){return this.bu}we(){return this.bu.V()}$a(){return this.pu}Gu(t,i){const s=this.uu[0],n=this.Ju(i,t,s);return this.cu.push(n),1===this.cu.length?this.Rh():this.Wr(),n}Qu(t){const i=this.fe(t),s=this.cu.indexOf(t);r(-1!==s,"Series not found"),this.cu.splice(s,1),l(i).ba(t),t.M&&t.M()}Nh(t,i){const s=l(this.fe(t));s.ba(t);const n=this.Ru(i);if(null===n){const n=t.xi();s.ma(t,i,n)}else{const e=n.Wt===s?t.xi():void 0;n.Wt.ma(t,i,e)}}Y_(){const t=new J(2);t.gs(),this.Cu(t)}tc(t){const i=new J(2);i.Ss(t),this.Cu(i)}ys(){const t=new J(2);t.ys(),this.Cu(t)}ks(t){const i=new J(2);i.ks(t),this.Cu(i)}xs(t){const i=new J(2);i.xs(t),this.Cu(i)}ic(){return this.Fi.rightPriceScale.visible?"right":"left"}sc(){return this.xu}nc(){return this.yu}Pt(t){const i=this.xu,s=this.yu;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.mu||this.mu.zs!==s||this.mu.Ws!==i)this.mu={zs:s,Ws:i,ec:new Map};else{const i=this.mu.ec.get(t);if(void 0!==i)return i}const n=function(t,i,s){const[n,e,r,h]=v(t),[l,a,o,c]=v(i),d=[_(n+s*(l-n)),_(e+s*(a-e)),_(r+s*(o-r)),u(h+s*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(s,i,t/100);return this.mu.ec.set(t,n),n}Vu(t,i){const s=new J(i);if(null!==t){const n=this.uu.indexOf(t);s.fs(n,{ps:i})}return s}Tu(t,i){return void 0===i&&(i=2),this.Vu(this.fe(t),i)}Cu(t){this.wu&&this.wu(t),this.uu.forEach((t=>t.co().vl().dt()))}Ju(t,i,s){const n=new Mi(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.ic();return s.ma(n,e),G(e)||n.zr(t),n}ku(t){const i=this.Fi.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function us(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function cs(t){return!g(t)&&!S(t)}function ds(t){return g(t)}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(ns||(ns={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(es||(es={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(rs||(rs={}));class fs{constructor(t,i){this.Et=t,this.It=i}Mr(t){return this.Et===t.Et&&this.It===t.It}}function ps(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function vs(t){const i=l(t.getContext("2d"));return i.setTransform(1,0,0,1,0,0),i}function ms(t,i){const s=t.createElement("canvas"),n=ps(s);return s.style.width=`${i.Et}px`,s.style.height=`${i.It}px`,s.width=i.Et*n,s.height=i.It*n,s}function ws(i,s){const n=l(i.ownerDocument).createElement("canvas");i.appendChild(n);const e=t(n,{allowDownsampling:!1});return e.resizeCanvas({width:s.Et,height:s.It}),e}function bs(t,i){return t.rc-i.rc}function gs(t,i,s){const n=(t.rc-i.rc)/(t.rt-i.rt);return Math.sign(n)*Math.min(Math.abs(n),s)}class Ms{constructor(t,i,s,n){this.hc=null,this.lc=null,this.ac=null,this.oc=null,this._c=null,this.uc=0,this.cc=0,this.dc=!1,this.fc=t,this.vc=i,this.mc=s,this.Ps=n}wc(t,i){if(null!==this.hc){if(this.hc.rt===i)return void(this.hc.rc=t);if(Math.abs(this.hc.rc-t)<this.Ps)return}this.oc=this.ac,this.ac=this.lc,this.lc=this.hc,this.hc={rt:i,rc:t}}De(t,i){if(null===this.hc||null===this.lc)return;if(i-this.hc.rt>50)return;let s=0;const n=gs(this.hc,this.lc,this.vc),e=bs(this.hc,this.lc),r=[n],h=[e];if(s+=e,null!==this.ac){const t=gs(this.lc,this.ac,this.vc);if(Math.sign(t)===Math.sign(n)){const i=bs(this.lc,this.ac);if(r.push(t),h.push(i),s+=i,null!==this.oc){const t=gs(this.ac,this.oc,this.vc);if(Math.sign(t)===Math.sign(n)){const i=bs(this.ac,this.oc);r.push(t),h.push(i),s+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/s*r[t];Math.abs(l)<this.fc||(this._c={rc:t,rt:i},this.cc=l,this.uc=function(t,i){const s=Math.log(i);return Math.log(1*s/-t)/s}(Math.abs(l),this.mc))}bc(t){const i=l(this._c),s=t-i.rt;return i.rc+this.cc*(Math.pow(this.mc,s)-1)/Math.log(this.mc)}gc(t){return null===this._c||this.Mc(t)===this.uc}Sc(){return this.dc}yc(){this.dc=!0}Mc(t){const i=t-l(this._c).rt;return Math.min(i,this.uc)}}const Ss="undefined"!=typeof window;function ys(){return!!Ss&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function ks(){return!!Ss&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function xs(t){Ss&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class Cs{constructor(t,i,s){this.kc=0,this.xc=null,this.Cc={tt:Number.NEGATIVE_INFINITY,it:Number.POSITIVE_INFINITY},this.Tc=0,this.Dc=null,this.Pc={tt:Number.NEGATIVE_INFINITY,it:Number.POSITIVE_INFINITY},this.Oc=null,this.Nc=!1,this.Rc=null,this.Ac=null,this.Ec=!1,this.Ic=!1,this.Lc=!1,this.Bc=null,this.Vc=null,this.Fc=null,this.zc=null,this.Wc=null,this.jc=null,this.$c=null,this.Hc=0,this.Uc=!1,this.qc=!1,this.Yc=!1,this.Xc=0,this.Kc=null,this.Zc=!ks(),this.Gc=t=>{this.Jc(t)},this.Qc=t=>{if(this.td(t)){const i=this.sd(t);if(++this.Tc,this.Dc&&this.Tc>1){const{nd:s}=this.ed(Ps(t),this.Pc);s<30&&!this.Lc&&this.rd(i,this.ld.hd),this.ad()}}else{const i=this.sd(t);if(++this.kc,this.xc&&this.kc>1){const{nd:s}=this.ed(Ps(t),this.Cc);s<5&&!this.Ic&&this.od(i,this.ld._d),this.ud()}}},this.dd=t,this.ld=i,this.Fi=s,this.fd()}M(){null!==this.Bc&&(this.Bc(),this.Bc=null),null!==this.Vc&&(this.Vc(),this.Vc=null),null!==this.zc&&(this.zc(),this.zc=null),null!==this.Wc&&(this.Wc(),this.Wc=null),null!==this.jc&&(this.jc(),this.jc=null),null!==this.Fc&&(this.Fc(),this.Fc=null),this.pd(),this.ud()}vd(t){this.zc&&this.zc();const i=this.md.bind(this);if(this.zc=()=>{this.dd.removeEventListener("mousemove",i)},this.dd.addEventListener("mousemove",i),this.td(t))return;const s=this.sd(t);this.od(s,this.ld.wd),this.Zc=!0}ud(){null!==this.xc&&clearTimeout(this.xc),this.kc=0,this.xc=null,this.Cc={tt:Number.NEGATIVE_INFINITY,it:Number.POSITIVE_INFINITY}}ad(){null!==this.Dc&&clearTimeout(this.Dc),this.Tc=0,this.Dc=null,this.Pc={tt:Number.NEGATIVE_INFINITY,it:Number.POSITIVE_INFINITY}}md(t){if(this.Yc||null!==this.Ac)return;if(this.td(t))return;const i=this.sd(t);this.od(i,this.ld.bd),this.Zc=!0}gd(t){const i=Ns(t.changedTouches,l(this.Kc));if(null===i)return;if(this.Xc=Os(t),null!==this.$c)return;if(this.qc)return;this.Uc=!0;const s=this.ed(Ps(i),l(this.Ac)),{Md:n,Sd:e,nd:r}=s;if(this.Ec||!(r<5)){if(!this.Ec){const t=.5*n,i=e>=t&&!this.Fi.yd(),s=t>e&&!this.Fi.kd();i||s||(this.qc=!0),this.Ec=!0,this.Lc=!0,this.pd(),this.ad()}if(!this.qc){const s=this.sd(t,i);this.rd(s,this.ld.xd),Ds(t)}}}Cd(t){if(0!==t.button)return;const i=this.ed(Ps(t),l(this.Rc)),{nd:s}=i;if(s>=5&&(this.Ic=!0,this.ud()),this.Ic){const i=this.sd(t);this.od(i,this.ld.Td)}}ed(t,i){const s=Math.abs(i.tt-t.tt),n=Math.abs(i.it-t.it);return{Md:s,Sd:n,nd:s+n}}Dd(t){let i=Ns(t.changedTouches,l(this.Kc));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Kc=null,this.Xc=Os(t),this.pd(),this.Ac=null,this.jc&&(this.jc(),this.jc=null);const s=this.sd(t,i);if(this.rd(s,this.ld.Pd),++this.Tc,this.Dc&&this.Tc>1){const{nd:t}=this.ed(Ps(i),this.Pc);t<30&&!this.Lc&&this.rd(s,this.ld.hd),this.ad()}else this.Lc||(this.rd(s,this.ld.Od),this.ld.Od&&Ds(t));0===this.Tc&&Ds(t),0===t.touches.length&&this.Nc&&(this.Nc=!1,Ds(t))}Jc(t){if(0!==t.button)return;const i=this.sd(t);if(this.Rc=null,this.Yc=!1,this.Wc&&(this.Wc(),this.Wc=null),ys()){this.dd.ownerDocument.documentElement.removeEventListener("mouseleave",this.Gc)}if(!this.td(t))if(this.od(i,this.ld.Nd),++this.kc,this.xc&&this.kc>1){const{nd:s}=this.ed(Ps(t),this.Cc);s<5&&!this.Ic&&this.od(i,this.ld._d),this.ud()}else this.Ic||this.od(i,this.ld.Rd)}pd(){null!==this.Oc&&(clearTimeout(this.Oc),this.Oc=null)}Ad(t){if(null!==this.Kc)return;const i=t.changedTouches[0];this.Kc=i.identifier,this.Xc=Os(t);const s=this.dd.ownerDocument.documentElement;this.Lc=!1,this.Ec=!1,this.qc=!1,this.Ac=Ps(i),this.jc&&(this.jc(),this.jc=null);{const i=this.gd.bind(this),n=this.Dd.bind(this);this.jc=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",n)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",n,{passive:!1}),this.pd(),this.Oc=setTimeout(this.Ed.bind(this,t),240)}const n=this.sd(t,i);this.rd(n,this.ld.Id),this.Dc||(this.Tc=0,this.Dc=setTimeout(this.ad.bind(this),500),this.Pc=Ps(i))}Ld(t){if(0!==t.button)return;const i=this.dd.ownerDocument.documentElement;ys()&&i.addEventListener("mouseleave",this.Gc),this.Ic=!1,this.Rc=Ps(t),this.Wc&&(this.Wc(),this.Wc=null);{const t=this.Cd.bind(this),s=this.Jc.bind(this);this.Wc=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",s)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",s)}if(this.Yc=!0,this.td(t))return;const s=this.sd(t);this.od(s,this.ld.Bd),this.xc||(this.kc=0,this.xc=setTimeout(this.ud.bind(this),500),this.Cc=Ps(t))}fd(){this.dd.addEventListener("mouseenter",this.vd.bind(this)),this.dd.addEventListener("touchcancel",this.pd.bind(this));{const t=this.dd.ownerDocument,i=t=>{this.ld.Vd&&(t.target&&this.dd.contains(t.target)||this.ld.Vd())};this.Vc=()=>{t.removeEventListener("touchstart",i)},this.Bc=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}ks()&&(this.Fc=()=>{this.dd.removeEventListener("dblclick",this.Qc)},this.dd.addEventListener("dblclick",this.Qc)),this.dd.addEventListener("mouseleave",this.Fd.bind(this)),this.dd.addEventListener("touchstart",this.Ad.bind(this),{passive:!0}),xs(this.dd),this.dd.addEventListener("mousedown",this.Ld.bind(this)),this.zd(),this.dd.addEventListener("touchmove",(()=>{}),{passive:!1})}zd(){void 0===this.ld.Wd&&void 0===this.ld.jd&&void 0===this.ld.$d||(this.dd.addEventListener("touchstart",(t=>this.Hd(t.touches)),{passive:!0}),this.dd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.$c&&void 0!==this.ld.jd){const i=Ts(t.touches[0],t.touches[1])/this.Hc;this.ld.jd(this.$c,i),Ds(t)}}),{passive:!1}),this.dd.addEventListener("touchend",(t=>{this.Hd(t.touches)})))}Hd(t){1===t.length&&(this.Uc=!1),2!==t.length||this.Uc||this.Nc?this.Ud():this.qd(t)}qd(t){const i=this.dd.getBoundingClientRect()||{left:0,top:0};this.$c={tt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,it:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Hc=Ts(t[0],t[1]),void 0!==this.ld.Wd&&this.ld.Wd(),this.pd()}Ud(){null!==this.$c&&(this.$c=null,void 0!==this.ld.$d&&this.ld.$d())}Fd(t){if(this.zc&&this.zc(),this.td(t))return;if(!this.Zc)return;const i=this.sd(t);this.od(i,this.ld.Yd),this.Zc=!ks()}Ed(t){const i=Ns(t.touches,l(this.Kc));if(null===i)return;const s=this.sd(t,i);this.rd(s,this.ld.Xd),this.Lc=!0,this.Nc=!0}td(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:Os(t)<this.Xc+500}rd(t,i){i&&i.call(this.ld,t)}od(t,i){i&&i.call(this.ld,t)}sd(t,i){const s=i||t,n=this.dd.getBoundingClientRect()||{left:0,top:0};return{Kd:s.clientX,Zd:s.clientY,Gd:s.pageX,Jd:s.pageY,Qd:s.screenX,tf:s.screenY,if:s.clientX-n.left,sf:s.clientY-n.top,nf:t.ctrlKey,ef:t.altKey,rf:t.shiftKey,hf:t.metaKey,lf:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,af:t.type,_f:s.target,uf:t.view,cf:()=>{"touchstart"!==t.type&&Ds(t)}}}}function Ts(t,i){const s=t.clientX-i.clientX,n=t.clientY-i.clientY;return Math.sqrt(s*s+n*n)}function Ds(t){t.cancelable&&t.preventDefault()}function Ps(t){return{tt:t.pageX,it:t.pageY}}function Os(t){return t.timeStamp||performance.now()}function Ns(t,i){for(let s=0;s<t.length;++s)if(t[s].identifier===i)return t[s];return null}class Rs{constructor(t,i,s,n){this._e=new Ft(200),this.F=0,this.df="",this.Ke="",this.re=[],this.ff=new Map,this.F=t,this.df=i,this.Ke=D(t,s,n)}M(){this._e.he(),this.re=[],this.ff.clear()}pf(t,i,s,n,e){const r=this.vf(t,i);if("left"!==e){const i=ps(t.canvas);s-=Math.floor(r.mf*i)}n-=Math.floor(r.qt/2),t.drawImage(r.wf,s,n,r.Ut,r.qt)}vf(t,i){let s;if(this.ff.has(i))s=h(this.ff.get(i));else{if(this.re.length>=200){const t=h(this.re.shift());this.ff.delete(t)}const n=ps(t.canvas),e=Math.ceil(this.F/4.5),r=Math.round(this.F/10),l=Math.ceil(this._e.Qt(t,i)),a=Ct(Math.round(l+2*e)),o=Ct(this.F+2*e),_=ms(document,new fs(a,o));s={Jt:i,mf:Math.round(Math.max(1,l)),Ut:Math.ceil(a*n),qt:Math.ceil(o*n),wf:_},0!==l&&(this.re.push(s.Jt),this.ff.set(s.Jt,s)),F(t=vs(s.wf),n,(()=>{t.font=this.Ke,t.fillStyle=this.df,t.fillText(i,0,o-e-r)}))}return s}}class As{constructor(t,i,s,n){this.fi=null,this.bf=null,this.gf=!1,this.Mf=new Ft(50),this.Sf=new Rs(11,"#000"),this.df=null,this.Ke=null,this.yf=0,this.kf=!1,this.xf=()=>{this.Cf(this.bu.V()),this.kf||this.Pi.Tf().jt().Wr()},this.Df=()=>{this.kf||this.Pi.Tf().jt().Wr()},this.Pi=t,this.Fi=i,this.bu=s,this.Pf="left"===n,this.Of=document.createElement("div"),this.Of.style.height="100%",this.Of.style.overflow="hidden",this.Of.style.width="25px",this.Of.style.left="0",this.Of.style.position="relative",this.Nf=ws(this.Of,new fs(16,16)),this.Nf.subscribeCanvasConfigured(this.xf);const e=this.Nf.canvas;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Rf=ws(this.Of,new fs(16,16)),this.Rf.subscribeCanvasConfigured(this.Df);const r=this.Rf.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={Bd:this.Af.bind(this),Id:this.Af.bind(this),Td:this.Ef.bind(this),xd:this.Ef.bind(this),Vd:this.If.bind(this),Nd:this.Lf.bind(this),Pd:this.Lf.bind(this),_d:this.Bf.bind(this),hd:this.Bf.bind(this),wd:this.Vf.bind(this),Yd:this.Ff.bind(this)};this.zf=new Cs(this.Rf.canvas,h,{yd:()=>!1,kd:()=>!0})}M(){this.zf.M(),this.Rf.unsubscribeCanvasConfigured(this.Df),this.Rf.destroy(),this.Nf.unsubscribeCanvasConfigured(this.xf),this.Nf.destroy(),null!==this.fi&&this.fi.Ma().v(this),this.fi=null,this.Sf.M()}Wf(){return this.Of}et(){return l(this.fi).V().borderColor}jf(){return this.Fi.textColor}T(){return this.Fi.fontSize}$f(){return D(this.T(),this.Fi.fontFamily)}Hf(){const t=this.bu.V(),i=this.df!==t.O,s=this.Ke!==t.D;return(i||s)&&(this.Cf(t),this.df=t.O),s&&(this.Mf.he(),this.Ke=t.D),t}Uf(){if(null===this.fi)return 0;let t=0;const i=this.Hf(),s=vs(this.Nf.canvas),n=this.fi.pl();s.font=this.$f(),n.length>0&&(t=Math.max(this.Mf.Qt(s,n[0].Pl),this.Mf.Qt(s,n[n.length-1].Pl)));const e=this.qf();for(let i=e.length;i--;){const n=this.Mf.Qt(s,e[i].Jt());n>t&&(t=n)}const r=this.fi.yt();if(null!==r&&null!==this.bf){const i=this.fi.$i(1,r),n=this.fi.$i(this.bf.It-2,r);t=Math.max(t,this.Mf.Qt(s,this.fi.mi(Math.floor(Math.min(i,n))+.11111111111111,r)),this.Mf.Qt(s,this.fi.mi(Math.ceil(Math.max(i,n))-.11111111111111,r)))}const h=t||34;let l=Math.ceil(i.k+i.C+i.R+i.A+h);return l+=l%2,l}Yf(t){if(t.Et<0||t.It<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.bf&&this.bf.Mr(t)||(this.bf=t,this.kf=!0,this.Nf.resizeCanvas({width:t.Et,height:t.It}),this.Rf.resizeCanvas({width:t.Et,height:t.It}),this.kf=!1,this.Of.style.width=t.Et+"px",this.Of.style.height=t.It+"px",this.Of.style.minWidth=t.Et+"px")}Xf(){return l(this.bf).Et}Ti(t){this.fi!==t&&(null!==this.fi&&this.fi.Ma().v(this),this.fi=t,t.Ma().l(this.zl.bind(this),this))}Ct(){return this.fi}he(){const t=this.Pi.Kf();this.Pi.Tf().jt().ao(t,l(this.Ct()))}Zf(t){if(null===this.bf)return;if(1!==t){const t=vs(this.Nf.canvas);this.Gf(),this.Jf(t,this.Nf.pixelRatio),this.Un(t,this.Nf.pixelRatio),this.Qf(t,this.Nf.pixelRatio),this.tp(t,this.Nf.pixelRatio)}const i=vs(this.Rf.canvas),s=this.bf.Et,n=this.bf.It;F(i,this.Rf.pixelRatio,(()=>{i.clearRect(0,0,s,n)})),this.ip(i,this.Rf.pixelRatio)}sp(){return this.Nf.canvas}dt(){var t;null===(t=this.fi)||void 0===t||t.pl()}Af(t){if(null===this.fi||this.fi.vi()||!this.Pi.Tf().V().handleScale.axisPressedMouseMove.price)return;const i=this.Pi.Tf().jt(),s=this.Pi.Kf();this.gf=!0,i.io(s,this.fi,t.sf)}Ef(t){if(null===this.fi||!this.Pi.Tf().V().handleScale.axisPressedMouseMove.price)return;const i=this.Pi.Tf().jt(),s=this.Pi.Kf(),n=this.fi;i.so(s,n,t.sf)}If(){if(null===this.fi||!this.Pi.Tf().V().handleScale.axisPressedMouseMove.price)return;const t=this.Pi.Tf().jt(),i=this.Pi.Kf(),s=this.fi;this.gf&&(this.gf=!1,t.no(i,s))}Lf(t){if(null===this.fi||!this.Pi.Tf().V().handleScale.axisPressedMouseMove.price)return;const i=this.Pi.Tf().jt(),s=this.Pi.Kf();this.gf=!1,i.no(s,this.fi)}Bf(t){this.Pi.Tf().V().handleScale.axisDoubleClickReset&&this.he()}Vf(t){if(null===this.fi)return;!this.Pi.Tf().jt().V().handleScale.axisPressedMouseMove.price||this.fi.vr()||this.fi.na()||this.np(1)}Ff(t){this.np(0)}qf(){const t=[],i=null===this.fi?void 0:this.fi;return(s=>{for(let n=0;n<s.length;++n){const e=s[n].ns(this.Pi.Kf(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.Pi.Kf().va()),t}Jf(t,i){if(null===this.bf)return;const s=this.bf.Et,n=this.bf.It;F(t,i,(()=>{const i=this.Pi.Kf().jt(),e=i.nc(),r=i.sc();e===r?z(t,0,0,s,n,e):W(t,0,0,s,n,e,r)}))}Un(t,i){if(null===this.bf||null===this.fi||!this.fi.V().borderVisible)return;t.save(),t.fillStyle=this.et();const s=Math.max(1,Math.floor(this.Hf().k*i));let n;n=this.Pf?Math.floor(this.bf.Et*i)-s:0,t.fillRect(n,0,s,Math.ceil(this.bf.It*i)),t.restore()}Qf(t,i){if(null===this.bf||null===this.fi)return;const s=this.fi.pl();t.save(),t.strokeStyle=this.et(),t.font=this.$f(),t.fillStyle=this.et();const n=this.Hf(),e=this.fi.V().borderVisible&&this.fi.V().drawTicks,r=this.Pf?Math.floor((this.bf.Et-n.C)*i-n.k*i):Math.floor(n.k*i),h=this.Pf?Math.round(r-n.R*i):Math.round(r+n.C*i+n.R*i),l=this.Pf?"right":"left",a=Math.max(1,Math.floor(i)),o=Math.floor(.5*i);if(e){const e=Math.round(n.C*i);t.beginPath();for(const n of s)t.rect(r,Math.round(n._l*i)-o,e,a);t.fill()}t.fillStyle=this.jf();for(const n of s)this.Sf.pf(t,n.Pl,h,Math.round(n._l*i),l);t.restore()}Gf(){if(null===this.bf||null===this.fi)return;let t=this.bf.It/2;const i=[],s=this.fi.va().slice(),n=this.Pi.Kf(),e=this.Hf();this.fi===n.ve()&&this.Pi.Kf().va().forEach((t=>{n.pe(t)&&s.push(t)}));const r=this.fi.rl()[0],h=this.fi;s.forEach((s=>{const e=s.ns(n,h);e.forEach((t=>{t.oi(null),t._i()&&i.push(t)})),r===s&&e.length>0&&(t=e[0].ti())}));const l=i.filter((i=>i.ti()<=t)),a=i.filter((i=>i.ti()>t));l.sort(((t,i)=>i.ti()-t.ti())),l.length&&a.length&&a.push(l[0]),a.sort(((t,i)=>t.ti()-i.ti())),i.forEach((t=>t.oi(t.ti())));if(this.fi.V().alignLabels){for(let t=1;t<l.length;t++){const i=l[t],s=l[t-1],n=s.qt(e,!1),r=i.ti(),h=s.ai();r>h-n&&i.oi(h-n)}for(let t=1;t<a.length;t++){const i=a[t],s=a[t-1],n=s.qt(e,!0),r=i.ti(),h=s.ai();r<h+n&&i.oi(h+n)}}}tp(t,i){if(null===this.bf)return;t.save();const s=this.bf,n=this.qf(),e=this.Hf(),r=this.Pf?"right":"left";n.forEach((n=>{if(n.ui()){const h=n.vt(l(this.fi));t.save(),h.U(t,e,this.Mf,s.Et,r,i),t.restore()}})),t.restore()}ip(t,i){if(null===this.bf||null===this.fi)return;t.save();const s=this.bf,n=this.Pi.Tf().jt(),e=[],r=this.Pi.Kf(),h=n.Iu().ns(r,this.fi);h.length&&e.push(h);const a=this.Hf(),o=this.Pf?"right":"left";e.forEach((n=>{n.forEach((n=>{t.save(),n.vt(l(this.fi)).U(t,a,this.Mf,s.Et,o,i),t.restore()}))})),t.restore()}np(t){this.Of.style.cursor=1===t?"ns-resize":"default"}zl(){const t=this.Uf();this.yf<t&&this.Pi.Tf().jt().Rh(),this.yf=t}Cf(t){this.Sf.M(),this.Sf=new Rs(t.T,t.O,t.P)}}function Es(t,i,s,n,e){t.Y&&t.Y(i,s,n,e)}function Is(t,i,s,n,e){t.U(i,s,n,e)}function Ls(t,i){return t.ss(i)}function Bs(t,i){return void 0!==t.Hh?t.Hh(i):[]}class Vs{constructor(t,i){this.bf=new fs(0,0),this.ep=null,this.rp=null,this.hp=null,this.lp=!1,this.ap=new w,this.op=0,this._p=!1,this.up=null,this.cp=!1,this.dp=null,this.fp=null,this.kf=!1,this.xf=()=>{this.kf||null===this.pp||this.gi().Wr()},this.Df=()=>{this.kf||null===this.pp||this.gi().Wr()},this.vp=t,this.pp=i,this.pp.uo().l(this.mp.bind(this),this,!0),this.wp=document.createElement("td"),this.wp.style.padding="0",this.wp.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.bp=document.createElement("td"),this.bp.style.padding="0",this.gp=document.createElement("td"),this.gp.style.padding="0",this.wp.appendChild(s),this.Nf=ws(s,new fs(16,16)),this.Nf.subscribeCanvasConfigured(this.xf);const n=this.Nf.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Rf=ws(s,new fs(16,16)),this.Rf.subscribeCanvasConfigured(this.Df);const e=this.Rf.canvas;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Mp=document.createElement("tr"),this.Mp.appendChild(this.bp),this.Mp.appendChild(this.wp),this.Mp.appendChild(this.gp),this.Sp(),this.zf=new Cs(this.Rf.canvas,this,{yd:()=>null===this.up&&!this.vp.V().handleScroll.vertTouchDrag,kd:()=>null===this.up&&!this.vp.V().handleScroll.horzTouchDrag})}M(){null!==this.ep&&this.ep.M(),null!==this.rp&&this.rp.M(),this.Rf.unsubscribeCanvasConfigured(this.Df),this.Rf.destroy(),this.Nf.unsubscribeCanvasConfigured(this.xf),this.Nf.destroy(),null!==this.pp&&this.pp.uo().v(this),this.zf.M()}Kf(){return l(this.pp)}yp(t){null!==this.pp&&this.pp.uo().v(this),this.pp=t,null!==this.pp&&this.pp.uo().l(Vs.prototype.mp.bind(this),this,!0),this.Sp()}Tf(){return this.vp}Wf(){return this.Mp}Sp(){if(null!==this.pp&&(this.kp(),0!==this.gi().ft().length)){if(null!==this.ep){const t=this.pp.Ja();this.ep.Ti(l(t))}if(null!==this.rp){const t=this.pp.Qa();this.rp.Ti(l(t))}}}xp(){null!==this.ep&&this.ep.dt(),null!==this.rp&&this.rp.dt()}Ha(){return null!==this.pp?this.pp.Ha():0}Ua(t){this.pp&&this.pp.Ua(t)}wd(t){if(!this.pp)return;this.Cp();const i=t.if,s=t.sf;this.Tp(i,s)}Bd(t){this.Cp(),this.Dp(),this.Tp(t.if,t.sf)}bd(t){if(!this.pp)return;this.Cp();const i=t.if,s=t.sf;this.Tp(i,s);const n=this.Ze(i,s);this.gi().Pu(n&&{Ou:n.Ou,Pp:n.Pp})}Rd(t){if(null===this.pp)return;this.Cp();const i=t.if,s=t.sf;if(this.ap.g()){const t=this.gi().Iu().bt();this.ap.m(t,{x:i,y:s})}}Td(t){this.Cp(),this.Op(t),this.Tp(t.if,t.sf)}Nd(t){null!==this.pp&&(this.Cp(),this._p=!1,this.Np(t))}Xd(t){if(this._p=!0,null===this.up){const i={x:t.if,y:t.sf};this.Rp(i,i)}}Yd(t){null!==this.pp&&(this.Cp(),this.pp.jt().Pu(null),this.Ap())}Ep(){return this.ap}Wd(){this.op=1,this.Ip()}jd(t,i){if(!this.vp.V().handleScale.pinch)return;const s=5*(i-this.op);this.op=i,this.gi().zu(t.tt,s)}Id(t){if(this._p=!1,this.cp=null!==this.up,this.Dp(),null!==this.up){const i=this.gi().Iu();this.dp={x:i.Yt(),y:i.Xt()},this.up={x:t.if,y:t.sf}}}xd(t){if(null===this.pp)return;const i=t.if,s=t.sf;if(null===this.up)this.Op(t);else{this.cp=!1;const t=l(this.dp),n=t.x+(i-this.up.x),e=t.y+(s-this.up.y);this.Tp(n,e)}}Pd(t){0===this.Tf().V().trackingMode.exitMode&&(this.cp=!0),this.Lp(),this.Np(t)}Ze(t,i){const s=this.pp;if(null===s)return null;const n=s.va();for(const e of n){const n=this.Bp(e.ss(s),t,i);if(null!==n)return{Ou:e,uf:n.uf,Pp:n.Pp}}return null}Vp(t,i){l("left"===i?this.ep:this.rp).Yf(new fs(t,this.bf.It))}Fp(){return this.bf}Yf(t){if(t.Et<0||t.It<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.bf.Mr(t)||(this.bf=t,this.kf=!0,this.Nf.resizeCanvas({width:t.Et,height:t.It}),this.Rf.resizeCanvas({width:t.Et,height:t.It}),this.kf=!1,this.wp.style.width=t.Et+"px",this.wp.style.height=t.It+"px")}zp(){const t=l(this.pp);t.Ga(t.Ja()),t.Ga(t.Qa());for(const i of t.rl())if(t.pe(i)){const s=i.Ct();null!==s&&t.Ga(s),i.rs()}}sp(){return this.Nf.canvas}Zf(t){if(0===t)return;if(null===this.pp)return;if(t>1&&this.zp(),null!==this.ep&&this.ep.Zf(t),null!==this.rp&&this.rp.Zf(t),1!==t){const t=vs(this.Nf.canvas);t.save(),this.Jf(t,this.Nf.pixelRatio),this.pp&&(this.Wp(t,this.Nf.pixelRatio),this.jp(t,this.Nf.pixelRatio),this.$p(t,this.Nf.pixelRatio,Ls)),t.restore()}const i=vs(this.Rf.canvas);i.clearRect(0,0,Math.ceil(this.bf.Et*this.Rf.pixelRatio),Math.ceil(this.bf.It*this.Rf.pixelRatio)),this.$p(i,this.Nf.pixelRatio,Bs),this.Hp(i,this.Rf.pixelRatio)}Up(){return this.ep}qp(){return this.rp}mp(){null!==this.pp&&this.pp.uo().v(this),this.pp=null}Jf(t,i){F(t,i,(()=>{const i=this.gi(),s=i.nc(),n=i.sc();s===n?z(t,0,0,this.bf.Et,this.bf.It,n):W(t,0,0,this.bf.Et,this.bf.It,s,n)}))}Wp(t,i){const s=l(this.pp),n=s.co().vl().vt(s.qt(),s.Ut());null!==n&&(t.save(),n.U(t,i,!1),t.restore())}jp(t,i){const s=this.gi().Eu();this.Yp(t,i,Ls,Es,s),this.Yp(t,i,Ls,Is,s)}Hp(t,i){this.Yp(t,i,Ls,Is,this.gi().Iu())}$p(t,i,s){const n=l(this.pp).va();for(const e of n)this.Yp(t,i,s,Es,e);for(const e of n)this.Yp(t,i,s,Is,e)}Yp(t,i,s,n,e){const r=l(this.pp),h=s(e,r),a=r.qt(),o=r.Ut(),_=r.jt().Du(),u=null!==_&&_.Ou===e,c=null!==_&&u&&void 0!==_.Pp?_.Pp.Ge:void 0;for(const s of h){const e=s.vt(a,o);null!==e&&(t.save(),n(e,t,i,u,c),t.restore())}}Bp(t,i,s){for(const n of t){const t=n.vt(this.bf.It,this.bf.Et);if(null!==t&&t.Ze){const e=t.Ze(i,s);if(null!==e)return{uf:n,Pp:e}}}return null}kp(){if(null===this.pp)return;const t=this.vp,i=this.pp.Ja().V().visible,s=this.pp.Qa().V().visible;i||null===this.ep||(this.bp.removeChild(this.ep.Wf()),this.ep.M(),this.ep=null),s||null===this.rp||(this.gp.removeChild(this.rp.Wf()),this.rp.M(),this.rp=null);const n=t.jt().Zu();i&&null===this.ep&&(this.ep=new As(this,t.V().layout,n,"left"),this.bp.appendChild(this.ep.Wf())),s&&null===this.rp&&(this.rp=new As(this,t.V().layout,n,"right"),this.gp.appendChild(this.rp.Wf()))}Xp(t){return t.lf&&this._p||null!==this.up}Kp(t){return Math.max(0,Math.min(t,this.bf.Et-1))}Zp(t){return Math.max(0,Math.min(t,this.bf.It-1))}Tp(t,i){this.gi().Yu(this.Kp(t),this.Zp(i),l(this.pp))}Ap(){this.gi().Xu()}Lp(){this.cp&&(this.up=null,this.Ap())}Rp(t,i){this.up=t,this.cp=!1,this.Tp(i.x,i.y);const s=this.gi().Iu();this.dp={x:s.Yt(),y:s.Xt()}}gi(){return this.vp.jt()}Gp(){const t=this.gi(),i=this.Kf(),s=i.ji();t.ho(i,s),t.Hu(),this.hp=null,this.lp=!1}Np(t){if(!this.lp)return;const i=performance.now();if(null!==this.fp&&this.fp.De(t.if,i),null===this.fp||this.fp.gc(i))return void this.Gp();const s=this.gi(),n=s.gt(),e=this.fp,r=()=>{if(e.Sc())return;const t=performance.now();let i=e.gc(t);if(!e.Sc()){const r=n.N_();s.$u(e.bc(t)),r===n.N_()&&(i=!0,this.fp=null)}i?this.Gp():requestAnimationFrame(r)};requestAnimationFrame(r)}Cp(){this.up=null}Dp(){if(!this.pp)return;if(this.Ip(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)l(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.pp.ji().vi()&&this.gi().gt().vi()}Op(t){if(null===this.pp)return;const i=this.gi();if(i.gt().vi())return;const s=this.vp.V(),n=s.handleScroll,e=s.kineticScroll;if((!n.pressedMouseMove||t.lf)&&(!n.horzTouchDrag&&!n.vertTouchDrag||!t.lf))return;const r=this.pp.ji(),h=performance.now();null!==this.hp||this.Xp(t)||(this.hp={x:t.Kd,y:t.Zd,Ao:h,if:t.if,sf:t.sf}),null!==this.fp&&this.fp.wc(t.if,h),null===this.hp||this.lp||this.hp.x===t.Kd&&this.hp.y===t.Zd||(null===this.fp&&(t.lf&&e.touch||!t.lf&&e.mouse)&&(this.fp=new Ms(.2,7,.997,15),this.fp.wc(this.hp.if,this.hp.Ao),this.fp.wc(t.if,h)),r.vi()||i.eo(this.pp,r,t.sf),i.ju(t.if),this.lp=!0),this.lp&&(r.vi()||i.ro(this.pp,r,t.sf),i.$u(t.if))}Ip(){const t=performance.now(),i=null===this.fp||this.fp.gc(t);null!==this.fp&&(i||this.Gp()),null!==this.fp&&(this.fp.yc(),this.fp=null)}}class Fs{constructor(t,i,s,n,e){this.ut=!0,this.bf=new fs(0,0),this.xf=()=>this.Zf(3),this.Pf="left"===t,this.bu=s.Zu,this.Fi=i,this.Jp=n,this.Qp=e,this.Of=document.createElement("div"),this.Of.style.width="25px",this.Of.style.height="100%",this.Of.style.overflow="hidden",this.Nf=ws(this.Of,new fs(16,16)),this.Nf.subscribeCanvasConfigured(this.xf)}M(){this.Nf.unsubscribeCanvasConfigured(this.xf),this.Nf.destroy()}Wf(){return this.Of}Fp(){return this.bf}Yf(t){if(t.Et<0||t.It<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.bf.Mr(t)||(this.bf=t,this.Nf.resizeCanvas({width:t.Et,height:t.It}),this.Of.style.width=`${t.Et}px`,this.Of.style.minWidth=`${t.Et}px`,this.Of.style.height=`${t.It}px`,this.ut=!0)}Zf(t){if(t<3&&!this.ut)return;if(0===this.bf.Et||0===this.bf.It)return;this.ut=!1;const i=vs(this.Nf.canvas);this.Jf(i,this.Nf.pixelRatio),this.Un(i,this.Nf.pixelRatio)}sp(){return this.Nf.canvas}Un(t,i){if(!this.Jp())return;const s=this.bf.Et;t.save(),t.fillStyle=this.Fi.timeScale.borderColor;const n=Math.floor(this.bu.V().k*i),e=this.Pf?Math.round(s*i)-n:0;t.fillRect(e,0,n,n),t.restore()}Jf(t,i){F(t,i,(()=>{z(t,0,0,this.bf.Et,this.bf.It,this.Qp())}))}}function zs(t,i){return t.$o>i.$o?t:i}class Ws{constructor(t){this.tv=null,this.iv=null,this.S=null,this.sv=!1,this.bf=new fs(0,0),this.nv=new w,this.Mf=new Ft(5),this.kf=!1,this.xf=()=>{this.kf||this.vp.jt().Wr()},this.Df=()=>{this.kf||this.vp.jt().Wr()},this.vp=t,this.Fi=t.V().layout,this.ev=document.createElement("tr"),this.rv=document.createElement("td"),this.rv.style.padding="0",this.hv=document.createElement("td"),this.hv.style.padding="0",this.Of=document.createElement("td"),this.Of.style.height="25px",this.Of.style.padding="0",this.lv=document.createElement("div"),this.lv.style.width="100%",this.lv.style.height="100%",this.lv.style.position="relative",this.lv.style.overflow="hidden",this.Of.appendChild(this.lv),this.Nf=ws(this.lv,new fs(16,16)),this.Nf.subscribeCanvasConfigured(this.xf);const i=this.Nf.canvas;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Rf=ws(this.lv,new fs(16,16)),this.Rf.subscribeCanvasConfigured(this.Df);const s=this.Rf.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.ev.appendChild(this.rv),this.ev.appendChild(this.Of),this.ev.appendChild(this.hv),this.av(),this.vp.jt().$a().l(this.av.bind(this),this),this.zf=new Cs(this.Rf.canvas,this,{yd:()=>!0,kd:()=>!1})}M(){this.zf.M(),null!==this.tv&&this.tv.M(),null!==this.iv&&this.iv.M(),this.Rf.unsubscribeCanvasConfigured(this.Df),this.Rf.destroy(),this.Nf.unsubscribeCanvasConfigured(this.xf),this.Nf.destroy()}Wf(){return this.ev}ov(){return this.tv}_v(){return this.iv}Bd(t){if(this.sv)return;this.sv=!0;const i=this.vp.jt();!i.gt().vi()&&this.vp.V().handleScale.axisPressedMouseMove.time&&i.Fu(t.if)}Id(t){this.Bd(t)}Vd(){const t=this.vp.jt();!t.gt().vi()&&this.sv&&(this.sv=!1,this.vp.V().handleScale.axisPressedMouseMove.time&&t.qu())}Td(t){const i=this.vp.jt();!i.gt().vi()&&this.vp.V().handleScale.axisPressedMouseMove.time&&i.Uu(t.if)}xd(t){this.Td(t)}Nd(){this.sv=!1;const t=this.vp.jt();t.gt().vi()&&!this.vp.V().handleScale.axisPressedMouseMove.time||t.qu()}Pd(){this.Nd()}_d(){this.vp.V().handleScale.axisDoubleClickReset&&this.vp.jt().ys()}hd(){this._d()}wd(){this.vp.jt().V().handleScale.axisPressedMouseMove.time&&this.np(1)}Yd(){this.np(0)}Fp(){return this.bf}uv(){return this.nv}cv(t,i,s){this.bf&&this.bf.Mr(t)||(this.bf=t,this.kf=!0,this.Nf.resizeCanvas({width:t.Et,height:t.It}),this.Rf.resizeCanvas({width:t.Et,height:t.It}),this.kf=!1,this.Of.style.width=t.Et+"px",this.Of.style.height=t.It+"px",this.nv.m(t)),null!==this.tv&&this.tv.Yf(new fs(i,t.It)),null!==this.iv&&this.iv.Yf(new fs(s,t.It))}dv(){const t=this.fv();return Math.ceil(t.k+t.C+t.T+t.I+t.N)}dt(){this.vp.jt().gt().pl()}sp(){return this.Nf.canvas}Zf(t){if(0===t)return;if(1!==t){const i=vs(this.Nf.canvas);this.Jf(i,this.Nf.pixelRatio),this.Un(i,this.Nf.pixelRatio),this.Qf(i,this.Nf.pixelRatio),null!==this.tv&&this.tv.Zf(t),null!==this.iv&&this.iv.Zf(t)}const i=vs(this.Rf.canvas),s=this.Rf.pixelRatio;i.clearRect(0,0,Math.ceil(this.bf.Et*s),Math.ceil(this.bf.It*s)),this.pv([this.vp.jt().Iu()],i,s)}Jf(t,i){F(t,i,(()=>{z(t,0,0,this.bf.Et,this.bf.It,this.vp.jt().sc())}))}Un(t,i){if(this.vp.V().timeScale.borderVisible){t.save(),t.fillStyle=this.vv();const s=Math.max(1,Math.floor(this.fv().k*i));t.fillRect(0,0,Math.ceil(this.bf.Et*i),s),t.restore()}}Qf(t,i){const s=this.vp.jt().gt().pl();if(!s||0===s.length)return;let n=s.reduce(zs,s[0]).$o;n>30&&n<50&&(n=30),t.save(),t.strokeStyle=this.vv();const e=this.fv(),r=e.k+e.C+e.I+e.T-e.L;t.textAlign="center",t.fillStyle=this.vv();const h=Math.floor(this.fv().k*i),l=Math.max(1,Math.floor(i)),a=Math.floor(.5*i);if(this.vp.jt().gt().V().borderVisible){t.beginPath();const n=Math.round(e.C*i);for(let e=s.length;e--;){const r=Math.round(s[e]._l*i);t.rect(r-a,h,l,n)}t.fill()}t.fillStyle=this.j(),F(t,i,(()=>{t.font=this.mv();for(const i of s)if(i.$o<n){const s=i.E_?this.wv(t,i._l,i.Pl):i._l;t.fillText(i.Pl,s,r)}t.font=this.bv();for(const i of s)if(i.$o>=n){const s=i.E_?this.wv(t,i._l,i.Pl):i._l;t.fillText(i.Pl,s,r)}})),t.restore()}wv(t,i,s){const n=this.Mf.Qt(t,s),e=n/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+n>this.bf.Et&&(i-=Math.abs(this.bf.Et-(r+n))),i}pv(t,i,s){const n=this.fv();for(const e of t)for(const t of e.Di())i.save(),t.vt().U(i,n,s),i.restore()}vv(){return this.vp.V().timeScale.borderColor}j(){return this.Fi.textColor}F(){return this.Fi.fontSize}mv(){return D(this.F(),this.Fi.fontFamily)}bv(){return D(this.F(),this.Fi.fontFamily,"bold")}fv(){null===this.S&&(this.S={k:1,L:NaN,I:NaN,N:NaN,bi:NaN,C:3,T:NaN,D:"",wi:new Ft});const t=this.S,i=this.mv();if(t.D!==i){const s=this.F();t.T=s,t.D=i,t.I=Math.ceil(s/2.5),t.N=t.I,t.bi=Math.ceil(s/2),t.L=Math.round(this.F()/5),t.wi.he()}return this.S}np(t){this.Of.style.cursor=1===t?"ew-resize":"default"}av(){const t=this.vp.jt(),i=t.V();i.leftPriceScale.visible||null===this.tv||(this.rv.removeChild(this.tv.Wf()),this.tv.M(),this.tv=null),i.rightPriceScale.visible||null===this.iv||(this.hv.removeChild(this.iv.Wf()),this.iv.M(),this.iv=null);const s={Zu:this.vp.jt().Zu()},n=()=>i.leftPriceScale.borderVisible&&t.gt().V().borderVisible,e=()=>t.sc();i.leftPriceScale.visible&&null===this.tv&&(this.tv=new Fs("left",i,s,n,e),this.rv.appendChild(this.tv.Wf())),i.rightPriceScale.visible&&null===this.iv&&(this.iv=new Fs("right",i,s,n,e),this.hv.appendChild(this.iv.Wf()))}}class js{constructor(t,i){var s;this.gv=[],this.Mv=0,this.Rl=0,this.oe=0,this.Sv=0,this.yv=0,this.kv=null,this.xv=!1,this.ap=new w,this.vu=new w,this.Fi=i,this.ev=document.createElement("div"),this.ev.classList.add("tv-lightweight-charts"),this.ev.style.overflow="hidden",this.ev.style.width="100%",this.ev.style.height="100%",(s=this.ev).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.Cv=document.createElement("table"),this.Cv.setAttribute("cellspacing","0"),this.ev.appendChild(this.Cv),this.Tv=this.Dv.bind(this),this.ev.addEventListener("wheel",this.Tv,{passive:!1}),this.gi=new _s(this.wu.bind(this),this.Fi),this.jt().Lu().l(this.Pv.bind(this),this),this.Ov=new Ws(this),this.Cv.appendChild(this.Ov.Wf());let n=this.Fi.width,e=this.Fi.height;if(0===n||0===e){const i=t.getBoundingClientRect();0===n&&(n=Math.floor(i.width),n-=n%2),0===e&&(e=Math.floor(i.height),e-=e%2)}this.Nv(n,e),this.Rv(),t.appendChild(this.ev),this.Av(),this.gi.gt().U_().l(this.gi.Rh.bind(this.gi),this),this.gi.$a().l(this.gi.Rh.bind(this.gi),this)}jt(){return this.gi}V(){return this.Fi}Ev(){return this.gv}Iv(){return this.Ov}M(){this.ev.removeEventListener("wheel",this.Tv),0!==this.Mv&&window.cancelAnimationFrame(this.Mv),this.gi.Lu().v(this),this.gi.gt().U_().v(this),this.gi.$a().v(this),this.gi.M();for(const t of this.gv)this.Cv.removeChild(t.Wf()),t.Ep().v(this),t.M();this.gv=[],l(this.Ov).M(),null!==this.ev.parentElement&&this.ev.parentElement.removeChild(this.ev),this.vu.M(),this.ap.M()}Nv(t,i,s=!1){if(this.Rl===i&&this.oe===t)return;this.Rl=i,this.oe=t;const n=i+"px",e=t+"px";l(this.ev).style.height=n,l(this.ev).style.width=e,this.Cv.style.height=n,this.Cv.style.width=e,s?this.Lv(new J(3)):this.gi.Rh()}Zf(t){void 0===t&&(t=new J(3));for(let i=0;i<this.gv.length;i++)this.gv[i].Zf(t.bs(i).ps);this.Fi.timeScale.visible&&this.Ov.Zf(t.ws())}zr(t){this.gi.zr(t),this.Av();const i=t.width||this.oe,s=t.height||this.Rl;this.Nv(i,s)}Ep(){return this.ap}Lu(){return this.vu}Bv(){null!==this.kv&&(this.Lv(this.kv),this.kv=null);const t=this.gv[0],i=ms(document,new fs(this.oe,this.Rl)),s=vs(i),n=ps(i);return F(s,n,(()=>{let i=0,n=0;const e=t=>{for(let e=0;e<this.gv.length;e++){const r=this.gv[e],h=r.Fp().It,a=l("left"===t?r.Up():r.qp()),o=a.sp();s.drawImage(o,i,n,a.Xf(),h),n+=h}};this.Vv()&&(e("left"),i=l(t.Up()).Xf()),n=0;for(let t=0;t<this.gv.length;t++){const e=this.gv[t],r=e.Fp(),h=e.sp();s.drawImage(h,i,n,r.Et,r.It),n+=r.It}i+=t.Fp().Et,this.Fv()&&(n=0,e("right"));const r=t=>{const e=l("left"===t?this.Ov.ov():this.Ov._v()),r=e.Fp(),h=e.sp();s.drawImage(h,i,n,r.Et,r.It)};if(this.Fi.timeScale.visible){i=0,this.Vv()&&(r("left"),i=l(t.Up()).Xf());const e=this.Ov.Fp(),h=this.Ov.sp();s.drawImage(h,i,n,e.Et,e.It),this.Fv()&&(i+=t.Fp().Et,r("right"),s.restore())}})),i}zv(t){if("left"===t&&!this.Vv())return 0;if("right"===t&&!this.Fv())return 0;if(0===this.gv.length)return 0;return l("left"===t?this.gv[0].Up():this.gv[0].qp()).Xf()}Wv(){let t=0,i=0,s=0;for(const n of this.gv)this.Vv()&&(i=Math.max(i,l(n.Up()).Uf())),this.Fv()&&(s=Math.max(s,l(n.qp()).Uf())),t+=n.Ha();const n=this.oe,e=this.Rl,r=Math.max(n-i-s,0),h=this.Fi.timeScale.visible;let a=h?this.Ov.dv():0;a%2&&(a+=1);const o=0+a,_=e<o?0:e-o,u=_/t;let c=0;for(let t=0;t<this.gv.length;++t){const n=this.gv[t];n.yp(this.gi.Au()[t]);let e=0,h=0;h=t===this.gv.length-1?_-c:Math.round(n.Ha()*u),e=Math.max(h,2),c+=e,n.Yf(new fs(r,e)),this.Vv()&&n.Vp(i,"left"),this.Fv()&&n.Vp(s,"right"),n.Kf()&&this.gi.Bu(n.Kf(),e)}this.Ov.cv(new fs(h?r:0,a),h?i:0,h?s:0),this.gi.qa(r),this.Sv!==i&&(this.Sv=i),this.yv!==s&&(this.yv=s)}Dv(t){let i=t.deltaX/100,s=-t.deltaY/100;if(0!==i&&this.Fi.handleScroll.mouseWheel||0!==s&&this.Fi.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,s*=120;break;case t.DOM_DELTA_LINE:i*=32,s*=32}if(0!==s&&this.Fi.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.ev.getBoundingClientRect().left;this.jt().zu(n,i)}0!==i&&this.Fi.handleScroll.mouseWheel&&this.jt().Wu(-80*i)}}Lv(t){var i;const s=t.ws();3===s&&this.jv(),3!==s&&2!==s||(this.$v(t),this.Hv(t),this.Ov.dt(),this.gv.forEach((t=>{t.xp()})),3===(null===(i=this.kv)||void 0===i?void 0:i.ws())&&(this.kv.Ts(t),this.jv(),this.$v(this.kv),this.Hv(this.kv),t=this.kv,this.kv=null)),this.Zf(t)}Hv(t){const i=t.Cs();for(const t of i)this.Ds(t)}$v(t){const i=this.gi.Au();for(let s=0;s<i.length;s++)t.bs(s).vs&&i[s].oo()}Ds(t){const i=this.gi.gt();switch(t.Ms){case 0:i.Y_();break;case 1:i.X_(t.Tt);break;case 2:i.ks(t.Tt);break;case 3:i.xs(t.Tt);break;case 4:i.I_()}}wu(t){null!==this.kv?this.kv.Ts(t):this.kv=t,this.xv||(this.xv=!0,this.Mv=window.requestAnimationFrame((()=>{if(this.xv=!1,this.Mv=0,null!==this.kv){const t=this.kv;this.kv=null,this.Lv(t)}})))}jv(){this.Rv()}Rv(){const t=this.gi.Au(),i=t.length,s=this.gv.length;for(let t=i;t<s;t++){const t=h(this.gv.pop());this.Cv.removeChild(t.Wf()),t.Ep().v(this),t.M()}for(let n=s;n<i;n++){const i=new Vs(this,t[n]);i.Ep().l(this.Uv.bind(this),this),this.gv.push(i),this.Cv.insertBefore(i.Wf(),this.Ov.Wf())}for(let s=0;s<i;s++){const i=t[s],n=this.gv[s];n.Kf()!==i?n.yp(i):n.Sp()}this.Av(),this.Wv()}qv(t,i){var s;const n=new Map;if(null!==t){this.gi.ft().forEach((i=>{const s=i._s().rh(t);null!==s&&n.set(i,s)}))}let e;if(null!==t){const i=null===(s=this.gi.gt().Mi(t))||void 0===s?void 0:s.Ho;void 0!==i&&(e=i)}const r=this.jt().Du(),h=null!==r&&r.Ou instanceof Mi?r.Ou:void 0,l=null!==r&&void 0!==r.Pp?r.Pp.Qe:void 0;return{rt:e,pn:null!=t?t:void 0,Yv:null!=i?i:void 0,Xv:h,Kv:n,Zv:l}}Uv(t,i){this.ap.m((()=>this.qv(t,i)))}Pv(t,i){this.vu.m((()=>this.qv(t,i)))}Av(){const t=this.Fi.timeScale.visible?"":"none";this.Ov.Wf().style.display=t}Vv(){return this.gv[0].Kf().Ja().V().visible}Fv(){return this.gv[0].Kf().Qa().V().visible}}function $s(t,i,s,n){const e=s.value;return{pn:i,rt:t,Tt:[e,e,e,e],Ho:n}}function Hs(t,i,s,n){const e=s.value,r={pn:i,rt:t,Tt:[e,e,e,e],Ho:n};return"color"in s&&void 0!==s.color&&(r.O=s.color),r}function Us(t){return void 0!==t.Tt}function qs(t){return(i,s,n,e)=>{return void 0===(r=n).open&&void 0===r.value?{rt:i,pn:s,Ho:e}:t(i,s,n,e);var r}}const Ys={Candlestick:qs((function(t,i,s,n){const e={pn:i,rt:t,Tt:[s.open,s.high,s.low,s.close],Ho:n};return"color"in s&&void 0!==s.color&&(e.O=s.color),"borderColor"in s&&void 0!==s.borderColor&&(e.Dt=s.borderColor),"wickColor"in s&&void 0!==s.wickColor&&(e.Xn=s.wickColor),e})),Bar:qs((function(t,i,s,n){const e={pn:i,rt:t,Tt:[s.open,s.high,s.low,s.close],Ho:n};return"color"in s&&void 0!==s.color&&(e.O=s.color),e})),Area:qs($s),Baseline:qs($s),Histogram:qs(Hs),Line:qs(Hs)};function Xs(t){return Ys[t]}function Ks(t){return 60*t*60*1e3}function Zs(t){return 60*t*1e3}const Gs=[{Gv:(Js=1,1e3*Js),$o:10},{Gv:Zs(1),$o:20},{Gv:Zs(5),$o:21},{Gv:Zs(30),$o:22},{Gv:Ks(1),$o:30},{Gv:Ks(3),$o:31},{Gv:Ks(6),$o:32},{Gv:Ks(12),$o:33}];var Js;function Qs(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let s=Gs.length-1;s>=0;--s)if(Math.floor(i.getTime()/Gs[s].Gv)!==Math.floor(t.getTime()/Gs[s].Gv))return Gs[s].$o;return 0}function tn(t,i=0){if(0===t.length)return;let s=0===i?null:t[i-1].rt.Ao,n=null!==s?new Date(1e3*s):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.rt.Ao);null!==n&&(i.jo=Qs(h,n)),e+=i.rt.Ao-(s||i.rt.Ao),s=i.rt.Ao,n=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),s=new Date(1e3*(t[0].rt.Ao-i));t[0].jo=Qs(new Date(1e3*t[0].rt.Ao),s)}}function sn(t){if(!cs(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{Ao:Math.round(i.getTime()/1e3),Ro:t}}function nn(t){if(!ds(t))throw new Error("time must be of type isUTCTimestamp");return{Ao:t}}function en(t){return 0===t.length?null:cs(t[0].time)?sn:nn}function rn(t){return ds(t)?nn(t):cs(t)?sn(t):sn(hn(t))}function hn(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ln(t){S(t.time)&&(t.time=hn(t.time))}function an(t){return{pn:0,Jv:new Map,$h:t}}function on(t){if(void 0!==t&&0!==t.length)return{Qv:t[0].rt.Ao,tm:t[t.length-1].rt.Ao}}function _n(t){let i;return t.forEach((t=>{void 0===i&&(i=t.Ho)})),h(i)}function un(t){void 0===t.Ho&&(t.Ho=t.time)}class cn{constructor(){this.im=new Map,this.sm=new Map,this.nm=new Map,this.rm=[]}M(){this.im.clear(),this.sm.clear(),this.nm.clear(),this.rm=[]}hm(t,i){let s=0!==this.im.size,n=!1;const e=this.sm.get(t);if(void 0!==e)if(1===this.sm.size)s=!1,n=!0,this.im.clear();else for(const i of this.rm)i.pointData.Jv.delete(t)&&(n=!0);let r=[];if(0!==i.length){const s=i;s.forEach((t=>un(t))),function(t){t.forEach(ln)}(i);const e=l(en(i)),h=Xs(t.$r());r=s.map((i=>{const s=e(i.time);let r=this.im.get(s.Ao);void 0===r&&(r=an(s),this.im.set(s.Ao,r),n=!0);const l=h(s,r.pn,i,i.Ho);return r.Jv.set(t,l),l}))}s&&this.lm(),this.am(t,r);let h=-1;if(n){const t=[];this.im.forEach((i=>{t.push({jo:0,rt:i.$h,pointData:i,Ho:_n(i.Jv)})})),t.sort(((t,i)=>t.rt.Ao-i.rt.Ao)),h=this.om(t)}return this._m(t,h,function(t,i){const s=on(t),n=on(i);if(void 0!==s&&void 0!==n)return{Lh:s.tm>=n.tm&&s.Qv>=n.Qv}}(this.sm.get(t),e))}Qu(t){return this.hm(t,[])}um(t,i){const s=i;un(s),ln(i);const n=l(en([i]))(i.time),e=this.nm.get(t);if(void 0!==e&&n.Ao<e.Ao)throw new Error(`Cannot update oldest data, last time=${e.Ao}, new time=${n.Ao}`);let r=this.im.get(n.Ao);const h=void 0===r;void 0===r&&(r=an(n),this.im.set(n.Ao,r));const a=Xs(t.$r())(n,r.pn,i,s.Ho);r.Jv.set(t,a),this.dm(t,a);const o={Lh:Us(a)};if(!h)return this._m(t,-1,o);const _={jo:0,rt:r.$h,pointData:r,Ho:_n(r.Jv)},u=ct(this.rm,_.rt.Ao,((t,i)=>t.rt.Ao<i));this.rm.splice(u,0,_);for(let t=u;t<this.rm.length;++t)dn(this.rm[t].pointData,t);return tn(this.rm,u),this._m(t,u,o)}dm(t,i){let s=this.sm.get(t);void 0===s&&(s=[],this.sm.set(t,s));const n=0!==s.length?s[s.length-1]:null;null===n||i.rt.Ao>n.rt.Ao?Us(i)&&s.push(i):Us(i)?s[s.length-1]=i:s.splice(-1,1),this.nm.set(t,i.rt)}am(t,i){0!==i.length?(this.sm.set(t,i.filter(Us)),this.nm.set(t,i[i.length-1].rt)):(this.sm.delete(t),this.nm.delete(t))}lm(){for(const t of this.rm)0===t.pointData.Jv.size&&this.im.delete(t.rt.Ao)}om(t){let i=-1;for(let s=0;s<this.rm.length&&s<t.length;++s){const n=this.rm[s],e=t[s];if(n.rt.Ao!==e.rt.Ao){i=s;break}e.jo=n.jo,dn(e.pointData,s)}if(-1===i&&this.rm.length!==t.length&&(i=Math.min(this.rm.length,t.length)),-1===i)return-1;for(let s=i;s<t.length;++s)dn(t[s].pointData,s);return tn(t,i),this.rm=t,i}fm(){if(0===this.sm.size)return null;let t=0;return this.sm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].pn))})),t}_m(t,i,s){const n={pm:new Map,gt:{C_:this.fm()}};if(-1!==i)this.sm.forEach(((i,e)=>{n.pm.set(e,{ye:i,vm:e===t?s:void 0})})),this.sm.has(t)||n.pm.set(t,{ye:[],vm:s}),n.gt.wm=this.rm,n.gt.bm=i;else{const i=this.sm.get(t);n.pm.set(t,{ye:i||[],vm:s})}return n}}function dn(t,i){t.pn=i,t.Jv.forEach((t=>{t.pn=i}))}function fn(t){return{value:t.Tt[3],time:t.Ho}}function pn(t){return{open:t.Tt[0],high:t.Tt[1],low:t.Tt[2],close:t.Tt[3],time:t.Ho}}const vn={Area:fn,Line:fn,Baseline:fn,Histogram:function(t){return{value:t.Tt[3],color:t.O,time:t.Ho}},Bar:pn,Candlestick:pn};function mn(t){return vn[t]}const wn={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:""};class bn{constructor(t){this.Ir=t}applyOptions(t){this.Ir.zr(t)}options(){return this.Ir.V()}gm(){return this.Ir}}class gn{constructor(t,i,s){this.Gs=t,this.Mm=i,this.Sm=s}priceFormatter(){return this.Gs.Zh()}priceToCoordinate(t){const i=this.Gs.yt();return null===i?null:this.Gs.Ct().xt(t,i.Tt)}coordinateToPrice(t){const i=this.Gs.yt();return null===i?null:this.Gs.Ct().$i(t,i.Tt)}barsInLogicalRange(t){if(null===t)return null;const i=new ts(new Gi(t.from,t.to)).Ko(),s=this.Gs._s();if(s.vi())return null;const n=s.rh(i.Hs(),1),e=s.rh(i.Us(),-1),r=l(s.sh()),h=l(s.os());if(null!==n&&null!==e&&n.pn>e.pn)return{barsBefore:t.from-r,barsAfter:h-t.to};const a={barsBefore:null===n||n.pn===r?t.from-r:n.pn-r,barsAfter:null===e||e.pn===h?h-t.to:h-e.pn};return null!==n&&null!==e&&(a.from=n.rt.Ro||n.rt.Ao,a.to=e.rt.Ro||e.rt.Ao),a}setData(t){this.Gs.$r(),this.Mm.ym(this.Gs,t)}update(t){this.Gs.$r(),this.Mm.km(this.Gs,t)}dataByIndex(t,i){const s=this.Gs._s().rh(t,i);return null===s?null:mn(this.seriesType())(s)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:rn(t.time)})));this.Gs.Vh(i)}markers(){return this.Gs.Fh().map((t=>{const{originalTime:i,time:s}=t,n=function(t,i){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(n=Object.getOwnPropertySymbols(t);e<n.length;e++)i.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(t,n[e])&&(s[n[e]]=t[n[e]])}return s}(t,["originalTime","time"]);return Object.assign({time:i},n)}))}applyOptions(t){this.Gs.zr(t)}options(){return k(this.Gs.V())}priceScale(){return this.Sm.priceScale(this.Gs.Ct().il())}createPriceLine(t){const i=b(k(wn),t),s=this.Gs.zh(i);return new bn(s)}removePriceLine(t){this.Gs.Wh(t.gm())}seriesType(){return this.Gs.$r()}}class Mn extends gn{applyOptions(t){us(t),super.applyOptions(t)}}const Sn={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.2}},yn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:T,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},kn={width:0,height:0,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:T},crosshair:{vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Sn),leftPriceScale:Object.assign(Object.assign({},Sn),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Sn),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},watermark:yn,localization:{locale:Ss?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},xn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Cn={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Tn={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Dn={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Pn={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},On={color:"#26a69a",base:0},Nn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Rn{constructor(t,i){this.xm=t,this.Cm=i}applyOptions(t){this.xm.jt().Nu(this.Cm,t)}options(){return this.fi().V()}width(){return G(this.Cm)?this.xm.zv(this.Cm):0}fi(){return l(this.xm.jt().Ru(this.Cm)).Ct}}class An{constructor(t,i){this.Tm=new w,this.r_=new w,this.nv=new w,this.gi=t,this.Ia=t.gt(),this.Ov=i,this.Ia.j_().l(this.Dm.bind(this)),this.Ia.H_().l(this.Pm.bind(this)),this.Ov.uv().l(this.Om.bind(this))}M(){this.Ia.j_().v(this),this.Ia.H_().v(this),this.Ov.uv().v(this),this.Tm.M(),this.r_.M(),this.nv.M()}scrollPosition(){return this.Ia.N_()}scrollToPosition(t,i){i?this.Ia.W_(t,1e3):this.gi.xs(t)}scrollToRealTime(){this.Ia.z_()}getVisibleRange(){var t,i;const s=this.Ia.b_();return null===s?null:{from:null!==(t=s.from.Ro)&&void 0!==t?t:s.from.Ao,to:null!==(i=s.to.Ro)&&void 0!==i?i:s.to.Ao}}setVisibleRange(t){const i={from:rn(t.from),to:rn(t.to)},s=this.Ia.y_(i);this.gi.tc(s)}getVisibleLogicalRange(){const t=this.Ia.w_();return null===t?null:{from:t.Hs(),to:t.Us()}}setVisibleLogicalRange(t){r(t.from<=t.to,"The from index cannot be after the to index."),this.gi.tc(t)}resetTimeScale(){this.gi.ys()}fitContent(){this.gi.Y_()}logicalToCoordinate(t){const i=this.gi.gt();return i.vi()?null:i.Ot(t)}coordinateToLogical(t){return this.Ia.vi()?null:this.Ia.T_(t)}timeToCoordinate(t){const i=rn(t),s=this.Ia.nl(i,!1);return null===s?null:this.Ia.Ot(s)}coordinateToTime(t){var i;const s=this.gi.gt(),n=s.T_(t),e=s.Hi(n);return null===e?null:null!==(i=e.Ro)&&void 0!==i?i:e.Ao}width(){return this.Ov.Fp().Et}height(){return this.Ov.Fp().It}subscribeVisibleTimeRangeChange(t){this.Tm.l(t)}unsubscribeVisibleTimeRangeChange(t){this.Tm.p(t)}subscribeVisibleLogicalRangeChange(t){this.r_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.r_.p(t)}subscribeSizeChange(t){this.nv.l(t)}unsubscribeSizeChange(t){this.nv.p(t)}applyOptions(t){this.Ia.zr(t)}options(){return k(this.Ia.V())}Dm(){this.Tm.g()&&this.Tm.m(this.getVisibleRange())}Pm(){this.r_.g()&&this.r_.m(this.getVisibleLogicalRange())}Om(t){this.nv.m(t.Et,t.It)}}function En(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const s=Math.round(t);if(Math.abs(s-t)<1e-8)return i;t*=10}return i}(i.minMove))}function In(t){return function(t){if(y(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:i,axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale&&y(t.handleScale.axisPressedMouseMove)){const i=t.handleScale.axisPressedMouseMove;t.handleScale.axisPressedMouseMove={time:i,price:i}}const i=t.handleScroll;y(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Ln{constructor(t,i){this.Nm=new cn,this.Rm=new Map,this.Am=new Map,this.Em=new w,this.Im=new w;const s=void 0===i?k(kn):b(k(kn),In(i));this.xm=new js(t,s),this.xm.Ep().l((t=>{this.Em.g()&&this.Em.m(this.Lm(t()))}),this),this.xm.Lu().l((t=>{this.Im.g()&&this.Im.m(this.Lm(t()))}),this);const n=this.xm.jt();this.Bm=new An(n,this.xm.Iv())}remove(){this.xm.Ep().v(this),this.xm.Lu().v(this),this.Bm.M(),this.xm.M(),this.Rm.clear(),this.Am.clear(),this.Em.M(),this.Im.M(),this.Nm.M()}resize(t,i,s){this.xm.Nv(t,i,s)}addAreaSeries(t={}){En(t.priceFormat);const i=b(k(Nn),Dn,t),s=this.xm.jt().Gu("Area",i),n=new gn(s,this,this);return this.Rm.set(n,s),this.Am.set(s,n),n}addBaselineSeries(t={}){En(t.priceFormat);const i=b(k(Nn),k(Pn),t),s=this.xm.jt().Gu("Baseline",i),n=new gn(s,this,this);return this.Rm.set(n,s),this.Am.set(s,n),n}addBarSeries(t={}){En(t.priceFormat);const i=b(k(Nn),Cn,t),s=this.xm.jt().Gu("Bar",i),n=new gn(s,this,this);return this.Rm.set(n,s),this.Am.set(s,n),n}addCandlestickSeries(t={}){us(t),En(t.priceFormat);const i=b(k(Nn),xn,t),s=this.xm.jt().Gu("Candlestick",i),n=new Mn(s,this,this);return this.Rm.set(n,s),this.Am.set(s,n),n}addHistogramSeries(t={}){En(t.priceFormat);const i=b(k(Nn),On,t),s=this.xm.jt().Gu("Histogram",i),n=new gn(s,this,this);return this.Rm.set(n,s),this.Am.set(s,n),n}addLineSeries(t={}){En(t.priceFormat);const i=b(k(Nn),Tn,t),s=this.xm.jt().Gu("Line",i),n=new gn(s,this,this);return this.Rm.set(n,s),this.Am.set(s,n),n}removeSeries(t){const i=h(this.Rm.get(t)),s=this.Nm.Qu(i);this.xm.jt().Qu(i),this.Vm(s),this.Rm.delete(t),this.Am.delete(i)}ym(t,i){this.Vm(this.Nm.hm(t,i))}km(t,i){this.Vm(this.Nm.um(t,i))}subscribeClick(t){this.Em.l(t)}unsubscribeClick(t){this.Em.p(t)}subscribeCrosshairMove(t){this.Im.l(t)}unsubscribeCrosshairMove(t){this.Im.p(t)}priceScale(t){return new Rn(this.xm,t)}timeScale(){return this.Bm}applyOptions(t){this.xm.zr(In(t))}options(){return this.xm.V()}takeScreenshot(){return this.xm.Bv()}Vm(t){const i=this.xm.jt();i.Ku(t.gt.C_,t.gt.wm,t.gt.bm),t.pm.forEach(((t,i)=>i.Z(t.ye,t.vm))),i.P_()}Fm(t){return h(this.Am.get(t))}Lm(t){const i=new Map;t.Kv.forEach(((t,s)=>{const n=mn(s.$r())(t);r(function(t){return void 0!==t.open||void 0!==t.value}(n)),i.set(this.Fm(s),n)}));const s=void 0===t.Xv?void 0:this.Fm(t.Xv);return{time:t.rt,logical:t.pn,point:t.Yv,hoveredSeries:s,hoveredMarkerId:t.Zv,seriesData:i}}}function Bn(t,i){let s;if(S(t)){const i=document.getElementById(t);r(null!==i,`Cannot find element in DOM with id=${t}`),s=i}else s=t;return new Ln(s,i)}function Vn(){return"4.0.0-dev+202203090750"}export{rs as ColorType,K as CrosshairMode,ns as LastPriceAnimationMode,s as LineStyle,i as LineType,wi as MismatchDirection,es as PriceLineSource,Fi as PriceScaleMode,is as TickMarkType,ss as TrackingModeExitMode,Bn as createChart,cs as isBusinessDay,ds as isUTCTimestamp,Vn as version};
